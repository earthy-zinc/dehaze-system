# HTTP 学习

## 简介

OSI计算机网络模型一共有七层，HTTP是应用层的协议，他在TCP/IP协议之上。HTTP规定
会话由客户端发起，服务端相应。

## Socket协议

socket时传输层协议的具体实现，他封装了协议本身复杂的实现方法，为开发人员提供了便利的网络连接，HTTP请求、
MySql数据库连接等等都是基于socket实现的。

### 传输层协议

socket是传输层协议用软件来实现时人们起的名称，而传输层的协议规定有TCP和UDP两种连接方式，对应的实现
也有两种。socket就是将这这两种协议规定的流程用代码实现了而已。

TCP是一种面向连接的协议，具备顺序控制和重传机制，是可靠的传输。建立连接需要三次握手，断开连接需要四次握手。

UDP是一种不可靠的协议，数据报文比TCP小，相同数据的传输所需带宽更少，传输速度更快，不需要实现建立连接。

socket连接有长连接和短连接两种：

1. 长连接
   * 两个结点建立连接并保持不断开的状态
   * 两边双向自由地进行数据传输
   * 全部数据传输完毕断开连接
2. 短连接
   * 一个结点1向另一个结点2建立连接
   * 1发送数据给2
   * 一条数据发送完毕立刻断开

这两种连接有不同的使用场景。连接的建立需要开销。频繁地建立连接容易造成资源浪费，因此
长连接适合客户端和服务端都比较明确、传输数据量大的情况。
每台服务器的连接数都是有限制的，如果长连接太多且没有及时断开，会造成阻塞影响新连接的建立。
HTTP是一种短连接，这样有利于处理高并发请求。

### socket编程

```java
import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.net.ServerSocket;
import java.net.Socket;

public class Server {
    public static void main(String[] args) {
        try (ServerSocket server = new ServerSocket(6000)) {
            // 当有客户端连接上时，服务器便接收到(accept)一个连接
            // 就走到这行代码建立一个socket网络通道供客户端和服务器进行数据交换
            Socket socket = server.accept();
            // 建立一个输出流，向客户端发送信息
            OutputStream outputStream = socket.getOutputStream();
            outputStream.write("hello".getBytes());
            outputStream.flush();
            outputStream.close();
        }
    }
}

public class Client {
    public static void main(String[] args) {
        try (Socket socket = new Socket("127.0.0.1", 6000)) {
            BufferedReader bufferedReader = new BufferedReader(
                    new InputStreamReader(socket.getInputStream())
            );
            System.out.println("客户端"+bufferedReader.readLine());
        }
    }
}
```

## 网络加速原理 CDN

CDN的全称为Content Delivery Network，内容分发网络。用户原本所访问的服务器可能离用户很远，
或者是服务器带宽很低，用户想要从这些服务器中获取资源速度就会很慢，因此我们可以把这些资源放在离用户
更近的、带宽更高的服务器上，以改善用户体验。而cdn他通过智能分配算法，让用户从最近的、最快速的
网络服务器中获取到他们想要的资源。

CDN的各个服务器结点时分布在各省各城市的运营商机房中。用户请求一个域名地址，浏览器对域名进行解析，
由于域名被内容分发网络CDN接管了，所以域名解析后只能获取到Cname，cdn通过Cname将访问地址代理到对应的
cdn服务器，浏览器通过Cname获取到最近的cdn服务器ip地址，然后直接访问cdn的缓存服务器，cdn缓存服务器
根据策略判断请求的资源缓存中是否存在，需不需要回到原来的那个站点更新，然后才会将资源返还给用户。

### cdn应用场景

1. 网页加速。cdn可以帮助网站缓存静态html，js，css、图片等不变的资源
2. 流媒体加速。cdn可以帮助网站缓存视频、音乐等对带宽要求较高的资源
3. 文件下载加速。对于一些大文件，如果想达到较快地下载速度，可以提前把这些文件放在各个地方的cdn服务器上
4. 边缘计算。边缘和中心是两个相反的概念，我们把服务器所在的地方称为网络的中心，而客户端所在的地方称为网络的边缘。cdn服务器离网络的边缘——客户端很近，我们在cdn服务器上对视频等文件进行压缩或解压等需要计算的操作，就可以进一步降低网络传输带宽，达到加速的目的。
5. 网格化计算。智能优化网络传输路径，达到加速的目的。

## https

### http的不足

1. 明文传输
2. 没有验证通信双方的身份
3. 无法保证数据完整性

### https的介绍

https是在http协议的基础上，利用SSL/TLS建立安全信道，加密数据包。
使用HTTPS的主要目的是提供对网站服务器的身份认证，同时保护交换数据的隐私和完整性。
HTTP服务的默认端口为80，HTTPS的默认端口是443.

### SSL

SSL即Secure Socket Layer，Https底层和Http一样是经过TCP通信的，所有应用协议都可以使用SSL进行安全通信。

SSL最早是由一个公司开发的安全传输协议，后来被采纳为标准并升级命名为TLS(Transport Layer Security)

#### SSL协议提供的服务

1. 认证用户和服务器，确保数据发送到正确的客户机和服务器
2. 加密数据以防止数据中途被窃取
3. 维护数据的完整性，确保数据在传输过程中不被改变

#### SSL协议的结构

SSL协议在传输层之上，应用层之下。因此TLS、SSL对于应用层是透明的。细分为握手协议和记录协议。

* 记录协议：建立在可靠传输协议之上，为高层协议提供数据封装、压缩、加密等功能的支持
* 握手协议：在记录协议之上，用于实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、
  交换加密密钥等。内部包括握手协议、密码参数修改、告警协议等。

### 加密算法

#### 对称加密算法

加密和解密的密钥是同一个

* 优点：速度快、计算量小
* 缺点：通信前双方需要协商好密钥，密钥在网络中传输不安全

#### 非对称加密算法

分为公开密钥和私有密钥。用公钥对数据加密，只有对应私钥才能解密，私钥加密，只有对应公钥才能解密。

* 优点：私钥不公开，而公钥可以提前告知，密钥不需要在协商中传输，安全性高
* 缺点：加密算法复杂，效率低

#### 混合加密算法

前期通过非对称加密协商好所需的对称加密算法的密钥。保证密钥的安全性，后面通信使用这个密钥采用对称加密算法进行通信

### 身份认证证书

一种用于身份认证的证书，是由第三方权威的认证机构颁发，服务端和客户端都可以通过证书来证明自己的身份。
大部分网站都只需要认证服务端，当用户访问网站时，浏览器会去证书颁发机构校验对方的身份。不符合或者是自己生成的
证书就会弹出警告。对于银行等有客户端认证需求的网站，会采用客户端和服务端双向认证。

#### 自签名证书

可以借助OpenSSL工具来生成

#### 服务端认证

1. 浏览器向服务器发送请求
2. 服务器将证书和申请证书流程中生成的一对密钥中的公钥发给浏览器
3. 浏览器收到证书进行分析，然后验证签名
4. 签名验证成功然后浏览器校验证书申请者身份
5. 服务器校验成功，进行密钥协商，使用非对称方法协商出对称加密需要的私钥，然后使用对称算法加密

### 公钥基础设施

https://cmsblogs.cn/4450.html

## 网络安全

### 注入和欺骗

注入一般是将恶意代码以参数的形式传入系统，并且诱使系统或者用户手动触发代码事件。
欺骗通常是伪造某个客户端身份去访问服务器。
那么注入和欺骗的方式主要有以下四种：

#### 会话模拟

#### 跨站脚本攻击

#### SQL注入

#### 域名劫持

### 代码逻辑缺陷

### 服务器问题
