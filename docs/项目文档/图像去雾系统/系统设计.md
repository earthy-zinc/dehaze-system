---
order: 2
---

# 系统设计
## 系统架构设计
### 业务架构
业务架构主要考虑到软件的功能需求，进行问题域的划分和领域建模等工作。架构模式如下：

![](assets/系统业务架构.png)

### 代码架构
在代码层面上，系统主要分为3块。

第一部分是前端，前端是图像去雾系统的前台部分，运行在PC端，移动端等浏览器上展现给用户浏览的网页。随着互联网技术的发展，HTML5，CSS3，前端框架的应用，跨平台响应式网页设计能够适应各种屏幕分辨率，完美的动效设计，给用户带来极高的用户体验。本系统主要依靠前端网页和用户进行交互。

第二部分是JAVA后端，运行在Java Web服务器Tomcat上，采用SpringBoot Java Web技术进行开发。java后端主要用作系统的基础管理如用户管理、角色管理、会员管理和日志记录上。由于Java在网页开发上的优势，本系统后端的绝大部分内容采用Java来开发。

第三部分是Python后端，由于深度学习技术主要基于Python、pytorch框架执行。因此系统最核心的部分采用Python进行编写，同时向外提供API接口以供Java后端调用。

### 部署架构
![](assets/部署架构.png)

## 技术栈
### 前端
| 环境           | 版本                |
|--------------|-------------------|
| node         | v18.18.0          |
| npm          | 9.8.1             |
| axios        | ^1.4.0            |
| echarts      | ^5.2.2            |
| element-plus | ^2.3.9            |
| pinia        | ^2.0.33           |
| vue          | ^3.3.4            |
| vue-router   | ^4.2.0            |
| vite         | ^4.4.2            |
| 更详细内容        | 见前端代码package.json | 


### JAVA后端
**Java 环境要求**

| 环境                       | 版本          |
|--------------------------|-------------|
| Java                     | 17          |
| maven                    | 3.9.5       |
| SpringBoot               | 3.1.0       |
| hutool                   | 5.8.15      |
| mysql driver             | 8.0.28      |
| druid                    | 1.2.16      |
| mybatis-plus             | 3.5.3.1     |
| knife4j                  | 4.0.0       |
| mapstruct                | 1.5.3.Final |
| lombok-mapstruct-binding | 0.2.0       |
| xxl-job                  | 2.4.0       |
| jjwt                     | 0.11.5      |
| easyexcel                | 3.2.1       |

**中间件要求**

| 软件    | 版本     |
|-------|--------|
| mysql | latest |
| redis | latest |

### Python后端
**软件环境要求**

| 环境            | 版本                     |
|---------------|------------------------|
| python        | 3.8.16                 |
| torch         | ~=1.8.1+cu101          |
| opencv-python | ~=4.8.1.78             |
| torchvision   | ~=0.9.1+cu101          |
| timm          | ~=0.9.8                |
| numpy         | ~=1.24.4               |
| Pillow        | ~=10.0.1               |
| scikit-image  | ~=0.21.0               |
| thop          | ~=0.1.1.post2209072238 |
| einops        | ~=0.7.0                |
| PyYAML        | ~=6.0.1                |
| yacs          | ~=0.1.8                |
| Django        | ~=4.2.7                |

**硬件环境要求**

| 要求         | 详情                 |
|------------|--------------------|
| 操作系统       | Ubuntu 18.04.6 LTS |
| CPU        | 暂无要求               |
| 内存         | 16G以上              |
| GPU        | Nvidia GPU 显存16G以上 |
| GPU Driver | 450.119.03         |
| CUDA       | 10.1               |
| gcc        | 9.3.0              | 

## 功能模块设计

### 去雾模块

#### 概述
去雾模块是本系统的核心功能模块，旨在提供图像去雾处理服务。该模块包含图片上传、图片下载、指标评价和去雾处理四个主要功能。通过使用不同的去雾模型，用户可以根据具体场景获得最佳去雾效果。

#### 功能描述

1. **图片上传**
    - **功能说明**：用户选择系统中现有的去雾模型，并上传有雾图像到系统中。
    - **操作步骤**：
        1. 用户在前端界面选择去雾模型。
        2. 用户点击上传按钮，选择有雾图像文件。
        3. 系统接收并验证图像文件格式和大小。
        4. 图像文件成功上传后，系统准备进行去雾处理。

2. **图片下载**
    - **功能说明**：用户可以下载去雾后的图像或原始有雾图像。
    - **操作步骤**：
        1. 用户在前端界面点击下载按钮。
        2. 系统根据用户选择提供去雾后的图像或原始图像下载链接。
        3. 用户点击链接下载图像文件。

3. **指标评价**
    - **功能说明**：用户可以评估去雾模型的去雾效果。用户需要上传与有雾图像尺寸大小对应的无雾图像，系统将评估去雾后的图像与真实无雾图像之间的相似度，并给出客观评价。
    - **操作步骤**：
        1. 用户在前端界面点击效果评估按钮。
        2. 用户上传对应的无雾图像文件。
        3. 系统接收并验证无雾图像文件格式和大小。
        4. 系统调用评价算法，计算去雾图像与无雾图像之间的相似度。
        5. 系统生成评价报告，并展示给用户。

4. **去雾处理**
    - **功能说明**：系统根据用户选择的去雾模型对上传的有雾图像进行处理，并返回去雾后的图像。
    - **操作步骤**：
        1. 用户在前端界面选择去雾模型并上传有雾图像。
        2. 用户点击开始去雾按钮。
        3. 系统将去雾请求发送给后端进行处理。
        4. 后端根据选择的去雾模型对图像进行处理。
        5. 处理完成后，后端将去雾结果返回给前端。
        6. 前端系统自动获取去雾后的图像并展示给用户，或者显示错误信息。

#### 技术实现

1. **前端实现**
    - 使用HTML/CSS/JavaScript/Vue构建用户界面。
    - 使用Axios实现文件上传和下载功能。

2. **后端实现**
    - 使用 Python 实现去雾算法。
    - 使用 Flask Web 框架处理HTTP请求。
    - 使用 OpenCV 和 PIL库 进行图像处理。
    - 使用 PyTorch 深度学习框架实现去雾模型。

#### 安全性和性能

1. **安全性**
    - 对上传的图像文件进行格式和大小验证，防止恶意文件上传。
    - 使用HTTPS协议保护数据传输安全。
    - 对用户数据进行加密存储，防止数据泄露。

2. **性能**
    - 使用缓存机制提高图像处理速度。
    - 使用异步处理方式，提高系统并发处理能力。
    - 对去雾模型进行优化，减少计算资源消耗。

#### 用户界面设计

1. **图片上传界面**
    - 显示去雾模型选择下拉框。
    - 显示文件上传按钮。
    - 显示上传进度条。

2. **图片下载界面**
    - 显示去雾后的图像预览。
    - 显示下载按钮。

3. **指标评价界面**
    - 显示无雾图像上传按钮。
    - 显示评价结果图表。

4. **去雾处理界面**
    - 显示去雾进度条。
    - 显示去雾后的图像预览。
    - 显示错误信息提示框。

通过以上设计，去雾模块能够为用户提供高效、安全、准确的去雾处理服务，并支持用户对去雾效果进行客观评价。


### 用户模块
用户模块是系统的基础模块，负责管理用户的注册、登录、权限分配等功能。用户模块的设计目标是确保系统的安全性和易用性。
系统管理员可以对当前系统中存在的用户进行管理，包括以下操作：
- **启用/禁用用户**：管理员可以根据需要启用或禁用某用户账号，控制用户的登录权限。
- **删除用户**：管理员可以删除系统中不再需要的用户账号，删除前应进行必要的确认操作以避免误删。
- **重置用户密码**：管理员可以重置用户的密码，通常需要用户提供一定的身份验证信息。
- **编辑用户信息**：管理员可以编辑用户的个人信息，如用户名、联系方式、邮箱地址等。

### 角色模块
角色模块是系统权限管理的基础，用于定义和管理用户角色及其权限。
系统管理员可以对当前系统存在的角色进行管理，包括以下操作：
- **创建角色**：管理员可以创建新的角色，定义角色的名称和编码。
- **编辑角色**：管理员可以编辑角色的基本信息和权限。
- **删除角色**：管理员可以删除系统中不再需要的角色，删除前需要确认该角色下没有关联的用户。
- **分配权限**：管理员可以为每个角色分配具体的权限，定义角色可以访问的系统功能和资源。

角色与权限的关系是一对多的关系，一个角色可以拥有多个权限。角色编码为ROOT的超级管理员具有系统的任何权限。其他角色则需要通过分配权限来获得相应的操作权限。

用户与角色是多对多的关系，一个用户可以分配有多个角色，用户的最终权限是所有角色权限的并集。用户与角色的关联信息也存储在数据库中，通常使用一个关联表来管理。

### 菜单模块
菜单模块是系统导航的基础，用于定义和管理用户在系统中的导航路径和功能模块。

系统管理员可以对当前系统界面中的左侧菜单栏进行管理。菜单管理功能允许管理员自定义系统的导航结构，确保用户能够根据其角色和权限访问适当的系统功能。

### 菜单类型
菜单模块中的菜单类型分为四种：目录、菜单、按钮、外链。

1. 目录
目录作为菜单的容器，用于组织和分类不同的菜单项。目录不直接链接到具体的页面或功能，而是用于构建菜单层次结构。
2. 菜单
菜单是指向具体页面或功能的链接。每个菜单项包含路由地址和页面文件地址，用于定义用户点击菜单时应该导航至哪个前端页面。
3. 按钮
按钮是菜单页面内部的元素，代表具体的操作。按钮可以关联权限，从而控制不同用户或角色是否可以见到或使用这些按钮。
4. 外链
外链是指向系统外部网址的链接。管理员可以通过菜单管理功能将外链添加到左侧菜单栏中，实现与外部系统的整合。

管理员可以通过以下操作对菜单进行管理：
- **新增菜单**：管理员可以手动新增菜单项，包括目录、菜单、按钮或外链。新增时需要输入菜单名称、排序顺序等信息。
- **编辑菜单**：管理员可以编辑现有菜单项的详细信息，如名称、排序、链接地址等。
- **删除菜单**：管理员可以删除不再需要的菜单项，删除操作应确保不影响系统的正常使用。
- **分配权限**：管理员可以为菜单项（特别是按钮）分配权限，确保只有具有相应权限的用户或角色可以访问。

菜单项，尤其是按钮，可以关联一个或多个权限标识。用户在访问菜单时，系统将检查用户是否具有相应的权限，以决定是否显示或启用该菜单项。
