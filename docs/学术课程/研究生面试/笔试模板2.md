# 试题名称：医院新冠管理系统

## 一、整体程序设计思路

使用语言C++11，整个程序主体以C语言面向过程的风格，但是使用了C++中的STL库。整个项目分为四个模块，分别是登录模块、主界面、文件读写模块、用户及学生管理模块。

**登录模块**：负责用户登录，密码修改等功能。

**主界面**：负责显示用户界面、处理用户输入是要进行哪一种操作以及用户权限的管理。

**通用文件读写模块**：功能是封装与文件读写相关的逻辑

**用户及学生管理模块**：主要负责数据的增删改查，其中数据在屏幕上的显示由单独的函数表示。

## 二、程序完成情况统计表



## 三、各模块运行结果截图

### 1.模块1

![image-20220324155440894](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324155440894.png)

![image-20220324155513752](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324155513752.png)

![image-20220324155559032](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324155559032.png)



## 四、数据定义

```c++
#include <windows.h>
#include <cstdio>
#include <cstring>
#include <iostream>
#include <vector>
#include <algorithm>

using namespace std;

typedef struct patient{
    char name[50];
    char gender[50];
    int age;
    char address[50];
    char phone[50];
    char email[50];
    char symptoms[50];
    char doctor[50];
}patient;
typedef struct vaccine{
    char name[50];
    char gender[50];
    int age;
    char date[50];
    char phone[50];
    char vaccineType[50];
}vaccine;
```



## 五、模块1

如果有登录界面的话说明需要建立 用户 数据组来管理登录用户。

```c++
void welcome(){
	printf("######################################\n");
	printf("#        欢迎使用新冠管理系统        #\n");
    printf("######################################\n");
    system("pause");
}

void header(){
    printf("--------------------------------------------\n");
    printf("                新冠管理系统\n");
    printf("--------------------------------------------\n");
}

void login(){
    system("cls");
    header();
    char id[50],password[50];
    while(true){
        printf("输入用户名及密码：\n");
        printf("用户名：");
        cin>>id;
        printf("密码：");
        cin>>password;

        if(strcmp(id,"admin")==0 &&  strcmp(password,"12345")==0){
            printf("登录成功，");
            break;
        }else{
            printf("用户名或密码错误，请重新输入：\n");
        }
    }
    system("pause");
}

void system(){
    printf("1.新增患者记录\n");
    printf("2.统计患者信息\n");
    printf("3.查询患者信息\n");
    printf("4.新增疫苗接种记录\n");
    printf("5.退出系统\n");
    printf("\n");
    
}

void mainPage(){

    while(true){
        system("cls");
        header();
        system();

        printf("请选择相应的功能（1-5）：↙\n");
        int flag;
    	cin>>flag;

        if(flag==1){
            addPatient();
        }else if(flag==2){
            statistics();
        }else if(flag==3){
            searchPatient();
        }else if(flag==4){
            addVaccinationRecord();
        }else if(flag==5){
            exit(0);
        }else{
            printf("输入无效，请重新选择：\n");
        }
    }
}
```



## 六、模块2

```c++
//***********模块2***********
/* 姓名只能包含2-6个字符，主治医生只能包含2-6个字。
* 性别只能输入为“男”或“女”，
* 年龄限定在1-120之间，
* 住址只能包含2-10个字，
* 手机只能由11个数字组成，
* 邮箱必须满足xxx@xxx.com的格式，
* 症状只能包含2-15个字，
*/

void getName(char *name){
    while(true){
        printf("姓名：");
        cin>>name;
        if(strlen(name)<2 || strlen(name)>6){
            printf("输入无效，姓名只能包含2-6个字符。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getGender(char *gender){
    while(true){
        printf("性别[男/女]：");
        cin>>gender;
        if(strcmp(gender,"男")!=0 || strcmp(gender,"女")!=0){
            printf("输入无效，性别只能输入为“男”或“女”。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getAge(int& age){
    while(true){
        printf("年龄：");
        cin>>age;
        if(age>120 || age<1){
            printf("输入无效，年龄限定在1-120之间。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getAddress(char *address){
    while(true){
        printf("住址：");
        cin>>address;
        if(strlen(address)<4 || strlen(address)>20){
            printf("输入无效，住址只能包含2-10个字。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getPhone(char *phone){
    while(true){
        bool flag=true;

        printf("手机：");
        cin>>phone;

        if(strlen(phone)!=11){
            flag=false;
        }
        
        for(int i=0;i<strlen(phone);i++){
            if(phone[i]=='0'){
                continue;
            }
            if(isdigit(phone[i])==0){
                flag=false;
            }
        }

        if(flag){ 
            break;
        }else{
            printf("输入无效，手机只能由11个数字组成。请重新输入！\n");
        }
    }
}
void getEmail(char *email){
    while(true){
        printf("邮箱：");
        cin>>email;
        break;
    }
}
void getSymptoms(char *symptoms){
    while(true){
        printf("症状：");
        cin>>symptoms;
        if(strlen(symptoms)<4 || strlen(symptoms)>30){
            printf("输入无效，症状只能包含2-15个字。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getDoctor(char *doctor){
    while(true){
        printf("主治医生：");
        cin>>doctor;
        if(strlen(doctor)<2 || strlen(doctor)>6){
            printf("输入无效，主治医生只能包含2-6个字符。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getDate(char *date){
    while(true){
        printf("接种日期（dd/mm/yy）");
        int dd,mm,yy;
        int flag=scanf("%d/%d/%d",&dd,&mm,&yy);
        if(flag!=3){
            printf("输入无效，接种日期的格式为（dd/mm/yy）。请重新输入！\n");
        }else{
            //strcpy(date,)
            break;
        }
    }
}
void getVaccineType(char *vaccineType){
    printf("选择疫苗：\n");
    printf("	1.国药中生北京\n");
    printf("	2.国药中生武汉\n");
    printf("	3.北京科兴中维\n");
    printf("请选择（1-3）：");
    while(true){
        int flag;
        cin>>flag;
        if(flag==1){
            strcpy(vaccineType,"国药中生北京");
            break;
        }else if(flag==2){
            strcpy(vaccineType,"国药中生武汉");
            break;
        }else if(flag==3){
            strcpy(vaccineType,"北京科兴中维");
            break;
        }else{
            printf("输入无效，请重新输入！\n");
        }
    }
}

void addPatient(){
    vector<patient> patients=readPatientData(patientInfo);

    char c='Y';
    while(c=='Y'){
        system("cls");
        header();
        printf("！！！！新增一条患者记录！！！！！\n");
        patient p;
        getName(p.name);
        getGender(p.gender);
        getAge(p.age);
        getAddress(p.address);
        getPhone(p.phone);
        getEmail(p.email);
        getSymptoms(p.symptoms);
        getName(p.doctor);

        patients.push_back(p);
        printf("……………患者信息录入成功……………\n");
        printf("是否继续录入[Y/N]：");
        cin>>c;

    }
    printf("感谢使用！\n");
    writePatientData(patientInfo,patients);
}

```



## 七、文件读写模块

```c++
//******文件读写模块**********
vector<patient> readPatientData(const char *fileName){
    patient p;
    vector<patient> patients;
    FILE *fp=fopen(fileName,"r");
    //文件不存在，则创建文件
    if (fp == NULL) {
		fp = fopen(fileName, "w");
	}
    while(fscanf(fp,"%s %s %d %s" "%s %s %s %s",\
            p.name, p.gender, &p.age, p.address,\
            p.phone, p.email, p.symptoms, p.doctor)>0){
        patients.push_back(p);
    }
    fclose(fp);
    return patients;
}

void writePatientData(const char *fileName,vector<patient> patients){
	FILE *fp=fopen(fileName,"w");
    for(int i=0;i<patients.size();i++){
        fprintf(fp,"%s %s %d %s" "%s %s %s %s\n",\
                patients[i].name, \
                patients[i].gender, \
                patients[i].age, \
                patients[i].address,\
                patients[i].phone, \
                patients[i].email, \
                patients[i].symptoms, \
                patients[i].doctor);
    }
    fclose(fp);
}

vector<vaccine> readVaccineData(const char *fileName){
    vaccine v;
    vector<vaccine> vaccines;
    FILE *fp=fopen(fileName,"r");
    //文件不存在，则创建文件
    if (fp == NULL) {
		fp = fopen(fileName, "w");
	}
    while(fscanf(fp,"%s %s %d %s" "%s %s",\
            v.name, v.gender, &v.age, v.date,\
            v.phone, v.vaccineType)>0){
        vaccines.push_back(v);
    }
    fclose(fp);
    return vaccines;
}

void writeVaccineData(const char *fileName,vector<vaccine> vaccines){
	FILE *fp=fopen(fileName,"w");
    for(int i=0;i<vaccines.size();i++){
        fprintf(fp,"%s %s %d %s" "%s %s",\
            vaccines[i].name, \
            vaccines[i].gender, \
            vaccines[i].age, \
            vaccines[i].date,\
            vaccines[i].phone, \
            vaccines[i].vaccineType);
    }
    fclose(fp);
}

```



## 八、模块3

```c++
//***********模块3***********
bool cmp(patient p1,patient p2){
    return p1.age>p2.age ? true : false;
}
void statistics(){
    header();
    printf("！！！！患者信息统计！！！！！\n");
    printf("姓名\t性别\t年龄\t住址\t手机\t邮箱\t症状\t主治医生\n");
    printf("========================================================================");

    vector<patient> patients=readPatientData(patientInfo);
    auto start=patients.begin(),end=patients.end();
    sort(start,end,cmp);

    for(int i=0;i<patients.size();i++){
        printf("%s\t%s\t%d\t%s\t" "%s\t%s\t%s\t%s\n",\
                patients[i].name, \
                patients[i].gender, \
                patients[i].age, \
                patients[i].address,\
                patients[i].phone, \
                patients[i].email, \
                patients[i].symptoms, \
                patients[i].doctor);
    }
}

```







## 模块4

```c++
//***********模块4***********
void searchPatient(){
    vector<patient> patients=readPatientData(patientInfo);
    auto start=patients.begin(),end=patients.end();    

    char c='Y';
    while(c=='Y'){
        system("cls");
        header();
        printf("！！！！患者信息查询！！！！！\n");
        
        printf("输入患者姓名：");
        char name[50];
        getName(name);

        vector<patient> goals;
        while (strcmp((*start).name,name)!=0){
            if(start==end) break;
            goals.push_back(*start);
            start++;
        }

        if(goals.size()!=0){
            printf("姓名\t性别\t年龄\t住址\t手机\t邮箱\t症状\t主治医生\n");
            printf("========================================================================");
            for(int i=0;i<goals.size();i++){
                printf("%s\t%s\t%d\t%s\t" "%s\t%s\t%s\t%s\n",\
                        goals[i].name, \
                        goals[i].gender, \
                        goals[i].age, \
                        goals[i].address,\
                        goals[i].phone, \
                        goals[i].email, \
                        goals[i].symptoms, \
                        goals[i].doctor);
            }
        }else{
            printf("未查询到该患者信息！\n");
        }

        printf("是否继续查询[Y/N]：");
        cin>>c;
    }
    printf("感谢使用！\n");
}

```

## 模块5

```c++
//***********模块5***********
void addVaccinationRecord(){
    char c='Y';
    while(c=='Y'){
        system("cls");
        header();
        printf("！！！！疫苗接种系统！！！！！\n");
        vaccine v;
        getName(v.name);
        getGender(v.gender);
        getAge(v.age);
        getDate(v.date);
        getPhone(v.phone);
        getVaccineType(v.vaccineType);

        printf("…………%s接种信息录入成功！…………\n",v.vaccineType);
        printf("是否继续录入[Y/N]：");
        cin>>c;

    }
    printf("感谢使用！\n");
}

```









































### 1. 增加

```c++
void addStuInfo(){
    //************获取存放在文件中的学生数据***************
    vector<student> students=readStuData(STUDENT_DATA);
	
    //*************循环主体，实现可以多次添加学生信息********
	char c='y';
	while(c=='y'){
        student s={0};
        printf("添加学生信息中\n");
        
        //************提醒用户输入，同时检验有效性**********             
        getStuID(s.stu_id);
		
        //**将该学生信息推入到数组中，同时在屏幕上显示刚刚输入的所有信息
        students.push_back(s);
		print(s);
        
        printf("信息录入成功！是否继续录入？(y/n)\n");
        cin>>c;
	}
	writeStuData(STUDENT_DATA,students,0);
}

```



### 2. 删除

```c++
void deleteStuInfo(){
    vector<student> students =readStuData(STUDENT_DATA);
    
    //********根据准考证号在所有学生信息中查询****
    char c='y';
    while(c=='y'){
        printf("请输入准考证号：");
        char id[50];
        cin>>id;

        auto first=students.begin(),end=students.end();
        while (strcmp((*first).id,id)!=0 && first!=end ){
            first++;
        }

        if(first==end){
            printf("用户名不存在！");
        }else{
            /*删除数据采用的是将待删除数据与数组最后一个元素互换
            然后删除最后一个元素*/
            swap(*first,*(end-1));
            students.pop_back();
            writeStuData(STUDENT_DATA,students,0);
            printf("学生删除成功！");
        }
        
        printf("是否继续？（y/n）");
        cin>>c;
    }
}
```



### 3. 更改

```c++
void alterStuInfo(){
    vector<student> students =readStuData(STUDENT_DATA);
    
    //********根据准考证号在所有学生信息中查询****
    char c='y';
    while(c=='y'){
        printf("请输入准考证号：");
        char id[50];
        cin>>id;

        auto first=students.begin(),end=students.end();
        while (strcmp((*first).id,id)!=0 && first!=end ){
            first++;
        }

        if(first==end){
            printf("用户名不存在！");
        }else{
            student s;
            strcpy(s.id,(*first).id);

            //这里输入修改逻辑，然后将整个数组重新写回文件。
            
            writeStuData(STUDENT_DATA,students,0);
            printf("修改成功！");
        }
        
        printf("是否继续查询（y/n）");
        cin>>c;
    }
}
```



### 4. 查询

简要思路：首先需要将文件的内容读取出来到vector向量中，然后根据查询要求进行查找，返回待查找的元素的迭代器。

```c++
void selectStuInfo(){
    vector<student> students =readStuData(STUDENT_DATA);
    
    //********根据准考证号在所有学生信息中查询****
    char c='y';
    while(c=='y'){
        printf("请输入准考证号：");
        char id[50];
        cin>>id;
		
        //顺序查找，返回待查找的元素的迭代器。
        auto first=students.begin(),end=students.end();
        while (strcmp((*first).id,id)!=0 && first!=end ){
            first++;
        }

        if(first!=end){
            print(*first);
        }else{
            printf("不存在该学生！\n");
        }
        
        printf("是否继续查询（y/n）");
        cin>>c;
    }
}

//查询操作可以单独拎出来，返回找到那个用户的指针，或者返回空，对它调用需要自行判断是否找到该用户
vector<student>::iterator findStu(vector<student> students,char* id){
    auto first=students.begin(),end=students.end();
    while (strcmp((*first).id,id)!=0 && first!=end ){
        first++;
    }
    return first;
}
```



### 5. 显示（视图层）

根据元素迭代器向屏幕输出，分为单个元素直接输出，多个元素输出

```c++
void print(student s){
    printf("学号 姓名 学院 报考类别 基础课成绩1 基础课成绩2 专业课成绩1 专业课成绩2 初始总成绩 "\
    "复试成绩 口语成绩 综合成绩\n");
    printf("%s %s %s %s %d %d %d %d %d %d %d %.2lf\n",\
            s.id, s.name, s.institute,\
            s.category, s.basicScore1,\
            s.basicScore2, s.professionScore1,\
            s.professionScore2, s.preScore,\
            s.secScore, s.oralScore,\
            s.totalAchieve);
}
```



### 6、数据有效性检验

这些函数对输入的有效性进行检验，如果输入不合法则会提示修改直到合法为止。

```C++
/*
函数功能：根据学号的第5、6位识别学院名称
参数：学生学号、需要识别的院校
返回值：无
*/
void getAcademy(char* stuID,char* academy) {
    char institute[][50]={"","通信学院","计算机学院","光电学院",\
        "自动化学院","经管学院","研究生院","外语学院","安法学院",\
        "体育学院","传媒学院","先进制造学院","马克思主义学院"};
	char num[3] = { "" };
	strncpy(num, stuID + 4, 2);
	num[2] = '\0';
	strcpy(academy, institute[atoi(num)]);
}

/*
函数功能：获取学生的健康状态，当学生体温>=37℃
		  或者存在咳嗽情形时，健康状态为异常
		  其余情形正常
参数：学生体温temperature，咳嗽状态cough
返回值：健康状态
*/
int getState(double temperature, int cough) {
	if (temperature <= 37.3 && cough == 0) {
		return 1;
	}
	else {
		return 0;
	}
}

void getStuID(char* stuID) {
	char num1[10] = {""};
	char num2[5] = { "" };
	char num3[10] = { "" };
	printf("学号：");
	while (1) {
		cin>>stuID;
		strncpy(num1, stuID, 4);
		num1[4] = '\0';
		strncpy(num2, stuID + 4, 2);
		num2[2] = '\0';
		strncpy(num3, stuID + 6, 3);
		num3[3] = '\0';
		if (strlen(stuID) != 9) {
			printf("学号格式错误，请重新输入!");
			continue;
		}
		if (atol(num1) < 2016 || atol(num1) > 2019 ||
			atol(num2) < 1 || atol(num2) > 12 ||
			atol(num3) < 1 || atol(num3) > 999) {
			printf("学号格式错误，请重新输入！");
			continue;
		}
		else {
			break;
		}
	}
}


/*
函数功能：获取时间，格式为xx：xx
参数：时间
返回值：无
*/
void getTime(char* time) {
	char num1[5] = { "" };
	char num2[5] = { "" };
	char num3[5] = { "" };
	printf("时间：");
	while (1) {
		scanf("%s", time);
		strncpy(num1, time, 2);
		num1[2] = '\0';
		strncpy(num2, time + 2, 1);
		num2[1] = '\0';
		strncpy(num3, time + 3, 2);
		num3[2] = '\0';
		if (strlen(time) != 5) {
			printf("时间格式错误，请重新输入!");
			continue;
		}
		if (atol(num1) < 0 || atol(num1) > 24 ||
			strcmp(num2,":") != 0 ||
			atol(num3) < 0 || atol(num3) > 59) {
			printf("时间格式错误，请重新输入！");
			continue;
		}
		else {
			break;
		}
	}
}

/*
函数功能：获取日期，格式为四位年份+两位月份+两位天数
		  统计时段为2022年4月29至2022年5月12日
参数：时间
返回值：无
*/
void getDate(char* date) {
	char num1[10] = { "" };//初始化为一个空串
	char num2[5] = { "" };
	char num3[5] = { "" };
	printf("日期：");
	while (1) {
		scanf("%s", date);
		strncpy(num1, date, 4);
		num1[4] = '\0';
		strncpy(num2, date + 4, 2);
		num2[2] = '\0';
		strncpy(num3, date + 6, 2);
		num3[2] = '\0';
		if (strlen(date) != 8) {
			printf("日期格式错误，请重新输入!");
			continue;
		}
		if (strcmp(num1,"2022") != 0 ) {
			printf("日期格式错误，请重新输入！");
			continue;
			
		}
		if (strcmp(num2, "04") != 0 && strcmp(num2, "05") != 0) {
			printf("日期格式错误，请重新输入！");
			continue;
		}
		if (strcmp(num2, "04") == 0) {
			if (atol(num3) < 29 || atol(num3) > 30) {
				printf("日期格式错误，请重新输入！");
				continue;
			}
			else {
				break;
			}
		}
		if (strcmp(num2, "05") == 0) {
			if (atol(num3) < 1 || atol(num3) > 12) {
				printf("日期格式错误，请重新输入！");
				continue;
			}
			else {
				break;
			}
		}
	}
}
```



### 7、排序算法

```c++
/*排序时对日期的处理：这里默认输入的日期格式都是正确的。并且日期统计时间段为 2020 年 4 月 29 日至 2020 年 5 月 12 日，因此可以直接将其转化为整数，比较大小。或许可以直接对字符串比较。但保险起见，使用整数。
*/
bool cmp(student s1,student s2){
    int idcmp=strcmp(s1.id,s2.id),datecmp=strcmp(s1.date,s2.date);
    if(idcmp!=0){
        return idcmp>0 ? true : false;
    }else if(datecmp!=0){
        return datecmp>0 ? true : false;
    }else{
        return true;
    }
}
```



在功能选择界面按“1”后进入该模块，该模块为患者信息管理模块，**数据须以文件（Record1.txt）的形式进行管理**。

患者信息包含**姓名，性别，年龄，住址，手机，邮箱，症状和主治医生。**

该模块所有信息均为手动输入，但需对输入信息进行**有效性判断**，**当输入信息不满足要求时，提示用户重新输入**。其中，

* 姓名只能包含2-6个字符，主治医生只能包含2-6个字。
* 性别只能输入为“男”或“女”，
* 年龄限定在1-120之间，
* 住址只能包含2-10个字，
* 手机只能由11个数字组成，
* 邮箱必须满足xxx@xxx.com的格式，
* 症状只能包含2-15个字，
* 输入一条患者信息成功后，将数据写入文件（Record1.txt）保存，输出成功的提示语，并询问用户是否继续录入。
