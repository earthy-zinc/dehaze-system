# 研究生笔试

## 试题：医院新冠管理系统

### 一、整体程序设计思路

使用语言C++11，整个程序主体以C语言面向过程的风格，但是使用了C++中的STL库。

### 二、程序完成情况统计表



### 三、各模块运行结果截图

#### 1.模块1

![image-20220324155440894](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324155440894.png)

![image-20220324155513752](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324155513752.png)

![image-20220324155559032](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324155559032.png)

#### 2.模块2

![image-20220324162526371](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324162526371.png)

#### 3.模块3

![image-20220324162851150](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324162851150.png)

#### 4.模块4

![image-20220324163253651](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324163253651.png)

#### 5.模块5

![image-20220324163723348](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324163723348.png)

### 四、数据定义

```c++
#include <windows.h>
#include <cstdio>
#include <cstring>
#include <iostream>
#include <vector>
#include <algorithm>

using namespace std;

typedef struct patient{
    char name[50];
    char gender[50];
    int age;
    char address[50];
    char phone[50];
    char email[50];
    char symptoms[50];
    char doctor[50];
}patient;
typedef struct vaccine{
    char name[50];
    char gender[50];
    int age;
    char date[50];
    char phone[50];
    char vaccineType[50];
}vaccine;
```



### 五、文件读写模块

```c++
//******文件读写模块**********
vector<patient> readPatientData(const char *fileName){
    patient p;
    vector<patient> patients;
    FILE *fp=fopen(fileName,"r");
    //文件不存在，则创建文件
    if (fp == NULL) {
		fp = fopen(fileName, "w");
	}
    while(fscanf(fp,"%s %s %d %s %s %s %s %s",\
            p.name, p.gender, &p.age, p.address,\
            p.phone, p.email, p.symptoms, p.doctor)>0){
        patients.push_back(p);
    }
    fclose(fp);
    return patients;
}

void writePatientData(const char *fileName,vector<patient> patients){
	FILE *fp=fopen(fileName,"w");
    for(int i=0;i<patients.size();i++){
        fprintf(fp,"%s %s %d %s %s %s %s %s\n",\
                patients[i].name, \
                patients[i].gender, \
                patients[i].age, \
                patients[i].address,\
                patients[i].phone, \
                patients[i].email, \
                patients[i].symptoms, \
                patients[i].doctor);
    }
    fclose(fp);
}

vector<vaccine> readVaccineData(const char *fileName){
    vaccine v;
    vector<vaccine> vaccines;
    FILE *fp=fopen(fileName,"r");
    //文件不存在，则创建文件
    if (fp == NULL) {
		fp = fopen(fileName, "w");
	}
    while(fscanf(fp,"%s %s %d %s %s %s",\
            v.name, v.gender, &v.age, v.date,\
            v.phone, v.vaccineType)>0){
        vaccines.push_back(v);
    }
    fclose(fp);
    return vaccines;
}

void writeVaccineData(const char *fileName,vector<vaccine> vaccines){
	FILE *fp=fopen(fileName,"w");
    for(int i=0;i<vaccines.size();i++){
        fprintf(fp,"%s %s %d %s %s %s",\
            vaccines[i].name, \
            vaccines[i].gender, \
            vaccines[i].age, \
            vaccines[i].date,\
            vaccines[i].phone, \
            vaccines[i].vaccineType);
    }
    fclose(fp);
}
```



### 六、模块1

如果有登录界面的话说明需要建立 用户 数据组来管理登录用户。

```c++
void welcome(){
	printf("######################################\n");
	printf("#        欢迎使用新冠管理系统        #\n");
    printf("######################################\n");
    system("pause");
}

void header(){
    printf("--------------------------------------------\n");
    printf("                新冠管理系统\n");
    printf("--------------------------------------------\n");
}

void login(){
    system("cls");
    header();
    char id[50],password[50];
    while(true){
        printf("输入用户名及密码：\n");
        printf("用户名：");
        cin>>id;
        printf("密码：");
        cin>>password;

        if(strcmp(id,"admin")==0 &&  strcmp(password,"12345")==0){
            printf("登录成功，");
            break;
        }else{
            printf("用户名或密码错误，请重新输入：\n");
        }
    }
    system("pause");
}

void system(){
    printf("1.新增患者记录\n");
    printf("2.统计患者信息\n");
    printf("3.查询患者信息\n");
    printf("4.新增疫苗接种记录\n");
    printf("5.退出系统\n");
    printf("\n");
    
}

void mainPage(){

    while(true){
        system("cls");
        header();
        system();

        printf("请选择相应的功能（1-5）：↙\n");
        int flag;
    	cin>>flag;

        if(flag==1){
            addPatient();
        }else if(flag==2){
            statistics();
        }else if(flag==3){
            searchPatient();
        }else if(flag==4){
            addVaccinationRecord();
        }else if(flag==5){
            exit(0);
        }else{
            printf("输入无效，请重新选择：\n");
        }
    }
}
```



### 七、模块2

```c++
//***********模块2***********
/* 姓名只能包含2-6个字符，主治医生只能包含2-6个字。
* 性别只能输入为“男”或“女”，
* 年龄限定在1-120之间，
* 住址只能包含2-10个字，
* 手机只能由11个数字组成，
* 邮箱必须满足xxx@xxx.com的格式，
* 症状只能包含2-15个字，
*/

void getName(char *name){
    while(true){
        printf("姓名：");
        cin>>name;
        if(strlen(name)<2 || strlen(name)>6){
            printf("输入无效，姓名只能包含2-6个字符。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getGender(char *gender){
    while(true){
        printf("性别[男/女]：");
        cin>>gender;
        if(strcmp(gender,"男")==0 || strcmp(gender,"女")==0){
            break;
        }else{
            printf("输入无效，性别只能输入为“男”或“女”。请重新输入！\n");
        }
    }
}
void getAge(int& age){
    while(true){
        printf("年龄：");
        cin>>age;
        if(age>120 || age<1){
            printf("输入无效，年龄限定在1-120之间。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getAddress(char *address){
    while(true){
        printf("住址：");
        cin>>address;
        if(strlen(address)<4 || strlen(address)>20){
            printf("输入无效，住址只能包含2-10个字。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getPhone(char *phone){
    while(true){
        bool flag=true;

        printf("手机：");
        cin>>phone;

        if(strlen(phone)!=11){
            flag=false;
        }
        
        for(int i=0;i<strlen(phone);i++){
            if(phone[i]=='0'){
                continue;
            }
            if(isdigit(phone[i])==0){
                flag=false;
            }
        }

        if(flag){ 
            break;
        }else{
            printf("输入无效，手机只能由11个数字组成。请重新输入！\n");
        }
    }
}
void getEmail(char *email){
    while(true){
        printf("邮箱：");
        cin>>email;
        int i,j;
        for(i=0;i<strlen(email);i++){
			if(email[i]=='@'){
                break;
            }
        }
        break;
    }
}
void getSymptoms(char *symptoms){
    while(true){
        printf("症状：");
        cin>>symptoms;
        if(strlen(symptoms)<4 || strlen(symptoms)>30){
            printf("输入无效，症状只能包含2-15个字。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getDoctor(char *doctor){
    while(true){
        printf("主治医生：");
        cin>>doctor;
        if(strlen(doctor)<2 || strlen(doctor)>6){
            printf("输入无效，主治医生只能包含2-6个字符。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getDate(char *date){
    while(true){
        printf("接种日期（dd/mm/yy）");
        int dd,mm,yy;
        int flag=scanf("%d/%d/%d",&dd,&mm,&yy);
        if(flag!=3){
            printf("输入无效，接种日期的格式为（dd/mm/yy）。请重新输入！\n");
        }else{
            //strcpy(date,)
            break;
        }
    }
}
void getVaccineType(char *vaccineType){
    printf("选择疫苗：\n");
    printf("	1.国药中生北京\n");
    printf("	2.国药中生武汉\n");
    printf("	3.北京科兴中维\n");
    printf("请选择（1-3）：");
    while(true){
        int flag;
        cin>>flag;
        if(flag==1){
            strcpy(vaccineType,"国药中生北京");
            break;
        }else if(flag==2){
            strcpy(vaccineType,"国药中生武汉");
            break;
        }else if(flag==3){
            strcpy(vaccineType,"北京科兴中维");
            break;
        }else{
            printf("输入无效，请重新输入！\n");
        }
    }
}

void addPatient(){
    vector<patient> patients=readPatientData(patientInfo);

    char c='Y';
    while(c=='Y'){
        system("cls");
        header();
        printf("！！！！新增一条患者记录！！！！！\n");
        patient p={0};
        getName(p.name);
        getGender(p.gender);
        getAge(p.age);
        getAddress(p.address);
        getPhone(p.phone);
        getEmail(p.email);
        getSymptoms(p.symptoms);
        getDoctor(p.doctor);

        patients.push_back(p);
        printf("……………患者信息录入成功……………\n");
        printf("是否继续录入[Y/N]：");
        cin>>c;

    }
    printf("感谢使用！\n");
    writePatientData(patientInfo,patients);
}

```





### 八、模块3

```c++
//***********模块3***********
bool cmp(patient p1,patient p2){
    return p1.age>p2.age ? true : false;
}
void statistics(){
    header();
    printf("！！！！患者信息统计！！！！！\n");
    printf("姓名\t性别\t年龄\t住址\t手机\t邮箱\t症状\t主治医生\n");
    printf("========================================================================\n");

    vector<patient> patients=readPatientData(patientInfo);
    auto start=patients.begin(),end=patients.end();
    sort(start,end,cmp);

    for(int i=0;i<patients.size();i++){
        printf("%s\t%s\t%d\t%s\t" "%s\t%s\t%s\t%s\n",\
                patients[i].name, \
                patients[i].gender, \
                patients[i].age, \
                patients[i].address,\
                patients[i].phone, \
                patients[i].email, \
                patients[i].symptoms, \
                patients[i].doctor);
    }
    system("pause");
}


```







### 九、模块4

```c++
//***********模块4***********
void searchPatient(){
    vector<patient> patients=readPatientData(patientInfo);
    auto start=patients.begin(),end=patients.end();    

    char c='Y';
    while(c=='Y'){
        system("cls");
        header();
        printf("！！！！患者信息查询！！！！！\n");
        
        char name[50];
        getName(name);

        vector<patient> goals;
        while (start!=end){
            if(strcmp((*start).name,name)==0){
                goals.push_back(*start);
            }
            start++;
        }

        if(goals.size()!=0){
            printf("姓名\t性别\t年龄\t住址\t手机\t邮箱\t症状\t主治医生\n");
            printf("========================================================================\n");
            for(int i=0;i<goals.size();i++){
                printf("%s\t%s\t%d\t%s\t" "%s\t%s\t%s\t%s\n",\
                        goals[i].name, \
                        goals[i].gender, \
                        goals[i].age, \
                        goals[i].address,\
                        goals[i].phone, \
                        goals[i].email, \
                        goals[i].symptoms, \
                        goals[i].doctor);
            }
        }else{
            printf("未查询到该患者信息！\n");
        }

        printf("是否继续查询[Y/N]：");
        cin>>c;
    }
    printf("感谢使用！\n");
}

```

### 十、模块5

```c++
//***********模块5***********
void addVaccinationRecord(){
    vector<vaccine> vaccines=readVaccineData(vaccineInfo);

    char c='Y';
    while(c=='Y'){
        system("cls");
        header();
        printf("！！！！疫苗接种系统！！！！！\n");
        vaccine v;
        getName(v.name);
        getGender(v.gender);
        getAge(v.age);
        getDate(v.date);
        getPhone(v.phone);
        getVaccineType(v.vaccineType);

        vaccines.push_back(v);
        printf("…………%s接种信息录入成功！…………\n",v.vaccineType);
        printf("是否继续录入[Y/N]：");
        cin>>c;
    }
    writeVaccineData(vaccineInfo,vaccines);
    printf("感谢使用！\n");
}

```

## 试题：医院新冠管理系统

### 一、整体程序设计思路

使用语言C++11，整个程序主体以C语言面向过程的风格，但是使用了C++中的STL库。整个项目分为四个模块，分别是登录模块、主界面、文件读写模块、用户及学生管理模块。

**登录模块**：负责用户登录，密码修改等功能。

**主界面**：负责显示用户界面、处理用户输入是要进行哪一种操作以及用户权限的管理。

**通用文件读写模块**：功能是封装与文件读写相关的逻辑

**用户及学生管理模块**：主要负责数据的增删改查，其中数据在屏幕上的显示由单独的函数表示。

### 二、程序完成情况统计表



### 三、各模块运行结果截图

#### 1.模块1

![image-20220324155440894](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324155440894.png)

![image-20220324155513752](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324155513752.png)

![image-20220324155559032](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220324155559032.png)



### 四、数据定义

```c++
#include <windows.h>
#include <cstdio>
#include <cstring>
#include <iostream>
#include <vector>
#include <algorithm>

using namespace std;

typedef struct patient{
    char name[50];
    char gender[50];
    int age;
    char address[50];
    char phone[50];
    char email[50];
    char symptoms[50];
    char doctor[50];
}patient;
typedef struct vaccine{
    char name[50];
    char gender[50];
    int age;
    char date[50];
    char phone[50];
    char vaccineType[50];
}vaccine;
```



### 五、模块1

如果有登录界面的话说明需要建立 用户 数据组来管理登录用户。

```c++
void welcome(){
	printf("######################################\n");
	printf("#        欢迎使用新冠管理系统        #\n");
    printf("######################################\n");
    system("pause");
}

void header(){
    printf("--------------------------------------------\n");
    printf("                新冠管理系统\n");
    printf("--------------------------------------------\n");
}

void login(){
    system("cls");
    header();
    char id[50],password[50];
    while(true){
        printf("输入用户名及密码：\n");
        printf("用户名：");
        cin>>id;
        printf("密码：");
        cin>>password;

        if(strcmp(id,"admin")==0 &&  strcmp(password,"12345")==0){
            printf("登录成功，");
            break;
        }else{
            printf("用户名或密码错误，请重新输入：\n");
        }
    }
    system("pause");
}

void system(){
    printf("1.新增患者记录\n");
    printf("2.统计患者信息\n");
    printf("3.查询患者信息\n");
    printf("4.新增疫苗接种记录\n");
    printf("5.退出系统\n");
    printf("\n");
    
}

void mainPage(){

    while(true){
        system("cls");
        header();
        system();

        printf("请选择相应的功能（1-5）：↙\n");
        int flag;
    	cin>>flag;

        if(flag==1){
            addPatient();
        }else if(flag==2){
            statistics();
        }else if(flag==3){
            searchPatient();
        }else if(flag==4){
            addVaccinationRecord();
        }else if(flag==5){
            exit(0);
        }else{
            printf("输入无效，请重新选择：\n");
        }
    }
}
```



### 六、模块2

```c++
//***********模块2***********
/* 姓名只能包含2-6个字符，主治医生只能包含2-6个字。
* 性别只能输入为“男”或“女”，
* 年龄限定在1-120之间，
* 住址只能包含2-10个字，
* 手机只能由11个数字组成，
* 邮箱必须满足xxx@xxx.com的格式，
* 症状只能包含2-15个字，
*/

void getName(char *name){
    while(true){
        printf("姓名：");
        cin>>name;
        if(strlen(name)<2 || strlen(name)>6){
            printf("输入无效，姓名只能包含2-6个字符。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getGender(char *gender){
    while(true){
        printf("性别[男/女]：");
        cin>>gender;
        if(strcmp(gender,"男")!=0 || strcmp(gender,"女")!=0){
            printf("输入无效，性别只能输入为“男”或“女”。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getAge(int& age){
    while(true){
        printf("年龄：");
        cin>>age;
        if(age>120 || age<1){
            printf("输入无效，年龄限定在1-120之间。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getAddress(char *address){
    while(true){
        printf("住址：");
        cin>>address;
        if(strlen(address)<4 || strlen(address)>20){
            printf("输入无效，住址只能包含2-10个字。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getPhone(char *phone){
    while(true){
        bool flag=true;

        printf("手机：");
        cin>>phone;

        if(strlen(phone)!=11){
            flag=false;
        }
        
        for(int i=0;i<strlen(phone);i++){
            if(phone[i]=='0'){
                continue;
            }
            if(isdigit(phone[i])==0){
                flag=false;
            }
        }

        if(flag){ 
            break;
        }else{
            printf("输入无效，手机只能由11个数字组成。请重新输入！\n");
        }
    }
}
void getEmail(char *email){
    while(true){
        printf("邮箱：");
        cin>>email;
        break;
    }
}
void getSymptoms(char *symptoms){
    while(true){
        printf("症状：");
        cin>>symptoms;
        if(strlen(symptoms)<4 || strlen(symptoms)>30){
            printf("输入无效，症状只能包含2-15个字。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getDoctor(char *doctor){
    while(true){
        printf("主治医生：");
        cin>>doctor;
        if(strlen(doctor)<2 || strlen(doctor)>6){
            printf("输入无效，主治医生只能包含2-6个字符。请重新输入！\n");
        }else{
            break;
        }
    }
}
void getDate(char *date){
    while(true){
        printf("接种日期（dd/mm/yy）");
        int dd,mm,yy;
        int flag=scanf("%d/%d/%d",&dd,&mm,&yy);
        if(flag!=3){
            printf("输入无效，接种日期的格式为（dd/mm/yy）。请重新输入！\n");
        }else{
            //strcpy(date,)
            break;
        }
    }
}
void getVaccineType(char *vaccineType){
    printf("选择疫苗：\n");
    printf("	1.国药中生北京\n");
    printf("	2.国药中生武汉\n");
    printf("	3.北京科兴中维\n");
    printf("请选择（1-3）：");
    while(true){
        int flag;
        cin>>flag;
        if(flag==1){
            strcpy(vaccineType,"国药中生北京");
            break;
        }else if(flag==2){
            strcpy(vaccineType,"国药中生武汉");
            break;
        }else if(flag==3){
            strcpy(vaccineType,"北京科兴中维");
            break;
        }else{
            printf("输入无效，请重新输入！\n");
        }
    }
}

void addPatient(){
    vector<patient> patients=readPatientData(patientInfo);

    char c='Y';
    while(c=='Y'){
        system("cls");
        header();
        printf("！！！！新增一条患者记录！！！！！\n");
        patient p;
        getName(p.name);
        getGender(p.gender);
        getAge(p.age);
        getAddress(p.address);
        getPhone(p.phone);
        getEmail(p.email);
        getSymptoms(p.symptoms);
        getName(p.doctor);

        patients.push_back(p);
        printf("……………患者信息录入成功……………\n");
        printf("是否继续录入[Y/N]：");
        cin>>c;

    }
    printf("感谢使用！\n");
    writePatientData(patientInfo,patients);
}

```



### 七、文件读写模块

```c++
//******文件读写模块**********
vector<patient> readPatientData(const char *fileName){
    patient p;
    vector<patient> patients;
    FILE *fp=fopen(fileName,"r");
    //文件不存在，则创建文件
    if (fp == NULL) {
		fp = fopen(fileName, "w");
	}
    while(fscanf(fp,"%s %s %d %s" "%s %s %s %s",\
            p.name, p.gender, &p.age, p.address,\
            p.phone, p.email, p.symptoms, p.doctor)>0){
        patients.push_back(p);
    }
    fclose(fp);
    return patients;
}

void writePatientData(const char *fileName,vector<patient> patients){
	FILE *fp=fopen(fileName,"w");
    for(int i=0;i<patients.size();i++){
        fprintf(fp,"%s %s %d %s" "%s %s %s %s\n",\
                patients[i].name, \
                patients[i].gender, \
                patients[i].age, \
                patients[i].address,\
                patients[i].phone, \
                patients[i].email, \
                patients[i].symptoms, \
                patients[i].doctor);
    }
    fclose(fp);
}

vector<vaccine> readVaccineData(const char *fileName){
    vaccine v;
    vector<vaccine> vaccines;
    FILE *fp=fopen(fileName,"r");
    //文件不存在，则创建文件
    if (fp == NULL) {
		fp = fopen(fileName, "w");
	}
    while(fscanf(fp,"%s %s %d %s" "%s %s",\
            v.name, v.gender, &v.age, v.date,\
            v.phone, v.vaccineType)>0){
        vaccines.push_back(v);
    }
    fclose(fp);
    return vaccines;
}

void writeVaccineData(const char *fileName,vector<vaccine> vaccines){
	FILE *fp=fopen(fileName,"w");
    for(int i=0;i<vaccines.size();i++){
        fprintf(fp,"%s %s %d %s" "%s %s",\
            vaccines[i].name, \
            vaccines[i].gender, \
            vaccines[i].age, \
            vaccines[i].date,\
            vaccines[i].phone, \
            vaccines[i].vaccineType);
    }
    fclose(fp);
}

```



### 八、模块3

```c++
//***********模块3***********
bool cmp(patient p1,patient p2){
    return p1.age>p2.age ? true : false;
}
void statistics(){
    header();
    printf("！！！！患者信息统计！！！！！\n");
    printf("姓名\t性别\t年龄\t住址\t手机\t邮箱\t症状\t主治医生\n");
    printf("========================================================================");

    vector<patient> patients=readPatientData(patientInfo);
    auto start=patients.begin(),end=patients.end();
    sort(start,end,cmp);

    for(int i=0;i<patients.size();i++){
        printf("%s\t%s\t%d\t%s\t" "%s\t%s\t%s\t%s\n",\
                patients[i].name, \
                patients[i].gender, \
                patients[i].age, \
                patients[i].address,\
                patients[i].phone, \
                patients[i].email, \
                patients[i].symptoms, \
                patients[i].doctor);
    }
}

```







### 模块4

```c++
//***********模块4***********
void searchPatient(){
    vector<patient> patients=readPatientData(patientInfo);
    auto start=patients.begin(),end=patients.end();    

    char c='Y';
    while(c=='Y'){
        system("cls");
        header();
        printf("！！！！患者信息查询！！！！！\n");
        
        printf("输入患者姓名：");
        char name[50];
        getName(name);

        vector<patient> goals;
        while (strcmp((*start).name,name)!=0){
            if(start==end) break;
            goals.push_back(*start);
            start++;
        }

        if(goals.size()!=0){
            printf("姓名\t性别\t年龄\t住址\t手机\t邮箱\t症状\t主治医生\n");
            printf("========================================================================");
            for(int i=0;i<goals.size();i++){
                printf("%s\t%s\t%d\t%s\t" "%s\t%s\t%s\t%s\n",\
                        goals[i].name, \
                        goals[i].gender, \
                        goals[i].age, \
                        goals[i].address,\
                        goals[i].phone, \
                        goals[i].email, \
                        goals[i].symptoms, \
                        goals[i].doctor);
            }
        }else{
            printf("未查询到该患者信息！\n");
        }

        printf("是否继续查询[Y/N]：");
        cin>>c;
    }
    printf("感谢使用！\n");
}

```

### 模块5

```c++
//***********模块5***********
void addVaccinationRecord(){
    char c='Y';
    while(c=='Y'){
        system("cls");
        header();
        printf("！！！！疫苗接种系统！！！！！\n");
        vaccine v;
        getName(v.name);
        getGender(v.gender);
        getAge(v.age);
        getDate(v.date);
        getPhone(v.phone);
        getVaccineType(v.vaccineType);

        printf("…………%s接种信息录入成功！…………\n",v.vaccineType);
        printf("是否继续录入[Y/N]：");
        cin>>c;

    }
    printf("感谢使用！\n");
}

```









































### 1. 增加

```c++
void addStuInfo(){
    //************获取存放在文件中的学生数据***************
    vector<student> students=readStuData(STUDENT_DATA);
	
    //*************循环主体，实现可以多次添加学生信息********
	char c='y';
	while(c=='y'){
        student s={0};
        printf("添加学生信息中\n");
        
        //************提醒用户输入，同时检验有效性**********             
        getStuID(s.stu_id);
		
        //**将该学生信息推入到数组中，同时在屏幕上显示刚刚输入的所有信息
        students.push_back(s);
		print(s);
        
        printf("信息录入成功！是否继续录入？(y/n)\n");
        cin>>c;
	}
	writeStuData(STUDENT_DATA,students,0);
}

```



### 2. 删除

```c++
void deleteStuInfo(){
    vector<student> students =readStuData(STUDENT_DATA);
    
    //********根据准考证号在所有学生信息中查询****
    char c='y';
    while(c=='y'){
        printf("请输入准考证号：");
        char id[50];
        cin>>id;

        auto first=students.begin(),end=students.end();
        while (strcmp((*first).id,id)!=0 && first!=end ){
            first++;
        }

        if(first==end){
            printf("用户名不存在！");
        }else{
            /*删除数据采用的是将待删除数据与数组最后一个元素互换
            然后删除最后一个元素*/
            swap(*first,*(end-1));
            students.pop_back();
            writeStuData(STUDENT_DATA,students,0);
            printf("学生删除成功！");
        }
        
        printf("是否继续？（y/n）");
        cin>>c;
    }
}
```



### 3. 更改

```c++
void alterStuInfo(){
    vector<student> students =readStuData(STUDENT_DATA);
    
    //********根据准考证号在所有学生信息中查询****
    char c='y';
    while(c=='y'){
        printf("请输入准考证号：");
        char id[50];
        cin>>id;

        auto first=students.begin(),end=students.end();
        while (strcmp((*first).id,id)!=0 && first!=end ){
            first++;
        }

        if(first==end){
            printf("用户名不存在！");
        }else{
            student s;
            strcpy(s.id,(*first).id);

            //这里输入修改逻辑，然后将整个数组重新写回文件。
            
            writeStuData(STUDENT_DATA,students,0);
            printf("修改成功！");
        }
        
        printf("是否继续查询（y/n）");
        cin>>c;
    }
}
```



### 4. 查询

简要思路：首先需要将文件的内容读取出来到vector向量中，然后根据查询要求进行查找，返回待查找的元素的迭代器。

```c++
void selectStuInfo(){
    vector<student> students =readStuData(STUDENT_DATA);
    
    //********根据准考证号在所有学生信息中查询****
    char c='y';
    while(c=='y'){
        printf("请输入准考证号：");
        char id[50];
        cin>>id;
		
        //顺序查找，返回待查找的元素的迭代器。
        auto first=students.begin(),end=students.end();
        while (strcmp((*first).id,id)!=0 && first!=end ){
            first++;
        }

        if(first!=end){
            print(*first);
        }else{
            printf("不存在该学生！\n");
        }
        
        printf("是否继续查询（y/n）");
        cin>>c;
    }
}

//查询操作可以单独拎出来，返回找到那个用户的指针，或者返回空，对它调用需要自行判断是否找到该用户
vector<student>::iterator findStu(vector<student> students,char* id){
    auto first=students.begin(),end=students.end();
    while (strcmp((*first).id,id)!=0 && first!=end ){
        first++;
    }
    return first;
}
```



### 5. 显示（视图层）

根据元素迭代器向屏幕输出，分为单个元素直接输出，多个元素输出

```c++
void print(student s){
    printf("学号 姓名 学院 报考类别 基础课成绩1 基础课成绩2 专业课成绩1 专业课成绩2 初始总成绩 "\
    "复试成绩 口语成绩 综合成绩\n");
    printf("%s %s %s %s %d %d %d %d %d %d %d %.2lf\n",\
            s.id, s.name, s.institute,\
            s.category, s.basicScore1,\
            s.basicScore2, s.professionScore1,\
            s.professionScore2, s.preScore,\
            s.secScore, s.oralScore,\
            s.totalAchieve);
}
```



### 6、数据有效性检验

这些函数对输入的有效性进行检验，如果输入不合法则会提示修改直到合法为止。

```C++
/*
函数功能：根据学号的第5、6位识别学院名称
参数：学生学号、需要识别的院校
返回值：无
*/
void getAcademy(char* stuID,char* academy) {
    char institute[][50]={"","通信学院","计算机学院","光电学院",\
        "自动化学院","经管学院","研究生院","外语学院","安法学院",\
        "体育学院","传媒学院","先进制造学院","马克思主义学院"};
	char num[3] = { "" };
	strncpy(num, stuID + 4, 2);
	num[2] = '\0';
	strcpy(academy, institute[atoi(num)]);
}

/*
函数功能：获取学生的健康状态，当学生体温>=37℃
		  或者存在咳嗽情形时，健康状态为异常
		  其余情形正常
参数：学生体温temperature，咳嗽状态cough
返回值：健康状态
*/
int getState(double temperature, int cough) {
	if (temperature <= 37.3 && cough == 0) {
		return 1;
	}
	else {
		return 0;
	}
}

void getStuID(char* stuID) {
	char num1[10] = {""};
	char num2[5] = { "" };
	char num3[10] = { "" };
	printf("学号：");
	while (1) {
		cin>>stuID;
		strncpy(num1, stuID, 4);
		num1[4] = '\0';
		strncpy(num2, stuID + 4, 2);
		num2[2] = '\0';
		strncpy(num3, stuID + 6, 3);
		num3[3] = '\0';
		if (strlen(stuID) != 9) {
			printf("学号格式错误，请重新输入!");
			continue;
		}
		if (atol(num1) < 2016 || atol(num1) > 2019 ||
			atol(num2) < 1 || atol(num2) > 12 ||
			atol(num3) < 1 || atol(num3) > 999) {
			printf("学号格式错误，请重新输入！");
			continue;
		}
		else {
			break;
		}
	}
}


/*
函数功能：获取时间，格式为xx：xx
参数：时间
返回值：无
*/
void getTime(char* time) {
	char num1[5] = { "" };
	char num2[5] = { "" };
	char num3[5] = { "" };
	printf("时间：");
	while (1) {
		scanf("%s", time);
		strncpy(num1, time, 2);
		num1[2] = '\0';
		strncpy(num2, time + 2, 1);
		num2[1] = '\0';
		strncpy(num3, time + 3, 2);
		num3[2] = '\0';
		if (strlen(time) != 5) {
			printf("时间格式错误，请重新输入!");
			continue;
		}
		if (atol(num1) < 0 || atol(num1) > 24 ||
			strcmp(num2,":") != 0 ||
			atol(num3) < 0 || atol(num3) > 59) {
			printf("时间格式错误，请重新输入！");
			continue;
		}
		else {
			break;
		}
	}
}

/*
函数功能：获取日期，格式为四位年份+两位月份+两位天数
		  统计时段为2022年4月29至2022年5月12日
参数：时间
返回值：无
*/
void getDate(char* date) {
	char num1[10] = { "" };//初始化为一个空串
	char num2[5] = { "" };
	char num3[5] = { "" };
	printf("日期：");
	while (1) {
		scanf("%s", date);
		strncpy(num1, date, 4);
		num1[4] = '\0';
		strncpy(num2, date + 4, 2);
		num2[2] = '\0';
		strncpy(num3, date + 6, 2);
		num3[2] = '\0';
		if (strlen(date) != 8) {
			printf("日期格式错误，请重新输入!");
			continue;
		}
		if (strcmp(num1,"2022") != 0 ) {
			printf("日期格式错误，请重新输入！");
			continue;
			
		}
		if (strcmp(num2, "04") != 0 && strcmp(num2, "05") != 0) {
			printf("日期格式错误，请重新输入！");
			continue;
		}
		if (strcmp(num2, "04") == 0) {
			if (atol(num3) < 29 || atol(num3) > 30) {
				printf("日期格式错误，请重新输入！");
				continue;
			}
			else {
				break;
			}
		}
		if (strcmp(num2, "05") == 0) {
			if (atol(num3) < 1 || atol(num3) > 12) {
				printf("日期格式错误，请重新输入！");
				continue;
			}
			else {
				break;
			}
		}
	}
}
```



### 7、排序算法

```c++
/*排序时对日期的处理：这里默认输入的日期格式都是正确的。并且日期统计时间段为 2020 年 4 月 29 日至 2020 年 5 月 12 日，因此可以直接将其转化为整数，比较大小。或许可以直接对字符串比较。但保险起见，使用整数。
*/
bool cmp(student s1,student s2){
    int idcmp=strcmp(s1.id,s2.id),datecmp=strcmp(s1.date,s2.date);
    if(idcmp!=0){
        return idcmp>0 ? true : false;
    }else if(datecmp!=0){
        return datecmp>0 ? true : false;
    }else{
        return true;
    }
}
```



在功能选择界面按“1”后进入该模块，该模块为患者信息管理模块，**数据须以文件（Record1.txt）的形式进行管理**。

患者信息包含**姓名，性别，年龄，住址，手机，邮箱，症状和主治医生。**

该模块所有信息均为手动输入，但需对输入信息进行**有效性判断**，**当输入信息不满足要求时，提示用户重新输入**。其中，

* 姓名只能包含2-6个字符，主治医生只能包含2-6个字。
* 性别只能输入为“男”或“女”，
* 年龄限定在1-120之间，
* 住址只能包含2-10个字，
* 手机只能由11个数字组成，
* 邮箱必须满足xxx@xxx.com的格式，
* 症状只能包含2-15个字，
* 输入一条患者信息成功后，将数据写入文件（Record1.txt）保存，输出成功的提示语，并询问用户是否继续录入。

## 试题01. 2020 学生返校健康管理系统

### 一、设计思路

分为四个模块，一个主界面。主界面用来提示用户系统都有哪些功能。

#### 1、定义与声明

建立student结构体用来存储学生的基本信息。

```c++
typedef struct student{
	char id[15];//学号
	char name[15];//姓名
	char institute[50];//学院
	double temperature;//体温
	int isCough;//是否咳嗽 1表示咳嗽0表示无症状
	int isHeathy;//是否健康 1表示正常0表示异常
	char time[9];//格式为 小时:分钟
	char date[9];//格式为 四位年份+两位月份+两位天数
}student;
```

定义常量用来表示文件名称，在实际写代码是会更好理解数据应存放在哪个文件中。

```c++
#define STUDENT_DATA "data1.txt"
#define SEARCH_RESULT "data2.txt"
#define ABNOMARL_STU "data3.txt"
#define WARNING_STU "data4.txt"
```

#### 2、通用的读写文件

在对数据进行增删改查之前，要进行一些文件读写操作。我将这些操作封装到了函数中，对于文件中的每一条数据，都放到了C++的vector容器（类似于数组）中，因此在系统中进行增删改查只需要对vector进行操作，而不涉及对文件的操作。

```c++
/*题目中的要求只需要对data1.txt的数据进行读取，其他文件只需要写入*/
vector<student> readData(const char *fileName){
    student s;
    vector<student> students;
    FILE *fp=fopen(fileName,"r");
    while( fscanf(fp,"",) > 0){
		students.push_back(s);
    }
    fclose(fp);
    return students;
}

/*传入的vector应该是过滤过后的。里面的东西会全部写入文件中。
  writeType==1  每个学生每天的基本健康信息填入，修改
  writeType==2  将按姓名、学号查询学生信息的结果写入文件中（与其他输出格式不同）
  writeType==3  将所有每天状态异常的学生当天的信息写入文件中
  writeType==4  将连续三天及以上健康状态异常的学生信息写入文件中
*/
void writeData(const char *fileName,vector<student> students,int writeType){
    int count=0;
    FILE *fp=fopen(fileName,"a");//append追加模式
    
    vector<student>::iterator first=students.begin();
    vector<student>::iterator end=students.end();
    
	if(writeType==1 || writeType==3 || writeType==4){
        printf("");
        while(first!=end){
            fprintf(fp,"",,);
            first++;
        }
    }else if(writeType==2){
        fprint(fp,"截止 %s 年 %s 月 %s 日该生的健康管理信息为：\n",,);
        fprintf(fp,"学号：%s\n姓名：%s\n学院：%s\n",(*first).,(*first).,(*first).);
        fprintf(fp,"体温 是否咳嗽 健康状态 时间 日期\n");
        while(first!=end){
            fprintf(fp,"",);
            first++;
        }
    }else{
        printf("参数填写有误！");
    }
    fclose(fp);
}
```



#### 3、学生基本信息管理（增删改查）

实现学生基本信息的查看、增加、修改功能。不需要删除。

**查询功能**：分为按学号查询、按姓名查询，查询期限是当前日期以前的每天信息。将查询结果呈现到屏幕上，并写入文件中。具体操作：

1. 从文件中读取学生信息到vector中。

2. 然后根据用户查询形式及查询内容，将查询到的结果输出

```c
void searchStuInfo(){
    int flag;
    char input[50];
    vector<student> students =readData(STUDENT_DATA);
    
    char c='y';
    while(c=='y'){
        vector<student>::iterator first=students.begin();
    	vector<student>::iterator end=students.end();
        printf("请选择查询方式：1、按学号查询。2、按姓名查询\n");
        cin>>flag;
        vector<student> goal_s;

        if(flag==1){
            printf("请输入学号：");
            cin>>input;
            while(first!=end){
                if(strcmp((*fisrt).id,input)==0){
                    goal_s.push_back(*first);
                }
                first++;
            }
        }else if(flag==2){
            printf("请输入姓名：");
            cin>>input;
            while(first!=end){
                if(strcmp((*fisrt).id,input)==0){
                    goal_s.push_back(*first);
                }
                first++;
            }
        }
        if(goal_s.size()==0){
            printf("查找失败，没有这个学生！\n");
        }else{
            writeData(SEARCH_RESULT,goal_s,2);
        }

        printf("是否继续查询？（y/n）\n");
        cin>>c;
    }
}
```

**增加功能：**引导用户填入学生信息。

引申函数-复试考号识别，传入学生考号，判断是否合法，然后填充报考学院。判断方法如下：

1. 首先判断字符串长度是否为9，不是则返回false。
2. 其次判断每个字符是否是数字，如果有非数字则返回false。
3. 分割字符串前4位，中间2位，后3位。转为数字判断大小。然后返回中间两位（学院代码）。

```c
int isCorrect_stu_id(char *stu_id){
	if(strlen(stu_id)!=9) return 0;
    
	for(int j=0;j<9;j++){
		if(!isdigit(stu_id[j])) return 0;
    }
    
	char y[5],i[3],n[4];
	strncpy(y,stu_id,4);
	strncpy(i,stu_id+4,2);
    strncpy(n,stu_id+6,3);
    
    /*atoi()会接收尽可能多的字符以组成合法的整数表示，并转换之为整数值。
	注意到一点，如果接受的参数有整数也有其他字符，那么只会转换整数部分，忽略非字符部分。
	如果没有数字字符，则返回0*/
	int year=atoi(y),institute=atoi(i),number=atoi(n);
	if(year>2019 || year<2016 || institute>12 || institute<1 || number==0){
		return 0;
	}
	return institute;
}
void addStuInfo(){
    char insti[][50]={"","通信学院","计算机学院","光电学院","自动化学院","经管学院",\
    "研究生院","外语学院","安法学院","体育学院","传媒学院","先进制造学院","马克思主义学院"};
	vector<student> students=readData(STUDENT_DATA);
    
    char c='y';
    while(c=='y'){
        student s;
        
        printf("请输入学生的各项信息：\n");
        printf("学生学号：");
        do{
        	cin>>s.id;
            int institute=isCorrect_stu_id(s.id);
            if(institute!=0){
				strcpy(s.institute,insti[institute]);
                break;
            }else{
                printf("学生学号输入错误，请重试！\n");
            }
        }while(1);
        
        printf("学生姓名：");
        cin>>s.name;

        printf("学生体温：");
        cin>>s.temperature;

        printf("是否咳嗽（如果咳嗽标记为 1，否则标记为 0）：");
        do{
        	cin>>s.isCough;
            if(s.isCough!=1 || s.isCough!=0){
                printf("输入不正确！咳嗽为 1，不咳嗽为 0");
            }else{
                break;
            }
        }while(1);
        
        printf("时间：");
        cin>>s.time;

        printf("日期：");
        cin>>s.date;
		
        //判断学生健康状态
        if(s.temperature>=37.3 || s.isCough==1 ){
			s.isHealthy=0;
        }else{
			s.isHealthy=1;
        }
        
        printf("学号\t姓名\t学院\t体温\t是否咳嗽\t健康状态\t时间\t日期\n");
        printf("%s\t %s\t %s\t %.1lf\t %d\t %d\t %s\t %s\n",\
               s.id,s.name,s.institute,s.temperature,s.isCough,s.isHealth,s.time,s.date);
        students.push_back(s);
        
        printf("是否继续录入？(y/n)\n");
        cin>>c;
    }
    writeData(STUDENT_DATA,students,1);
}
```

**修改功能：**因为数据是按天记录的，所以如果想要修改需要输入两个量，一个是学号，一个是日期。这里默认一个学生每天只进行一次健康上报。因此能搜索到唯一值进行修改。

```c++
void alterStuInfo(){
    char id[50],date[9];
    
    vector<student> students =readData(STUDENT_DATA);
    
    char c='y';
    while(c=='y'){
        vector<student>::iterator first=students.begin();
        vector<student>::iterator end=students.end();
        student goal_s;

        printf("请输入需要修改信息的学生学号：");
        cin>>id;
        printf("请输入需要修改信息的日期：");
        cin>>date;
        
        while(strcmp((*fisrt).id,id)==0  && strcmp((*fisrt).date,date)==0 && first!=end){
            first++;
        }
        
        if(first==end){
            printf("查找失败，未找到相应的数据！\n");
        }else{
            char flag='c';
            while(flag='c'){
                printf("请输入需要修改的项：");
                char input[50];
                cin>>input;
                if(strcmp(input,"姓名")==0){
                    printf("请输入更改后的姓名：");
                    (*first).name
                }else if(strcmp(input,"体温")==0){
                    printf("请输入更改后的体温：");
					(*first).
                }else if(strcmp(input,"是否咳嗽")==0){
                    printf("请输入更改后的状态：");
					(*first).isCough
                }else if(strcmp(input,"时间")==0){
                    printf("请输入更改后的时间：");
					(*first).time
                }else if(strcmp(input,"日期")==0){
                    printf("请输入更改后的日期：");
					(*first).date
                }else{
                    printf("输入不正确。\n");
                }
                printf("是否对该学生的信息继续修改？（y/n）\n");
                cin>>flag;
            }
            writeData(STUDENT_DATA,students,1);
        }
        printf("是否继续对其他学生或其他日期进行修改？（y/n）\n");
        cin>>c;
    }
}
```



#### 4、异常状况统计及预警

**异常状况统计**

```c++
void abnormalStatistic(){
	vector<student> students=readData(STUDENT_DATA);
    
    vector<student> goal_s;
    vector<student>::iterator first=students.begin();
    vector<student>::iterator end=students.end();
    
    while(first!=end){
        if(!(*first).isHealthY){
            goal_s.push_back(*first);
        }
        first++;
    }
    if(goal_s.size()==0){
        printf("无异常人员\n");
    }else{
        writeData(ABNORMAL_STU,goal_s,3);
    }
}
```



**健康状况预警**

思路是对vector进行排序，按照学号、日期进行排序，这里默认**每天每人只会进行一次健康上报**。然后从前往后，对 每一条数据进行逐个筛查。具体方法是设置计数量count，用来记录连续count天健康状态非正常。`boolean pre`用来记录该生昨天健康状况。先保存数组首元素的学号项，当学号不变时，往下遍历。分三种情况：

1. 昨天不正常，今天正常，count=0。 
2. 昨天不正常，今天不正常，count++。
3. 昨天正常，今天不正常，count=1。

```c++
/*排序时对日期的处理：这里默认输入的日期格式都是正确的。并且日期统计时间段为 2020 年 4 月 29 日至 2020 年 5 月 12 日，因此可以直接将其转化为整数，比较大小。或许可以直接对字符串比较。
*/
bool cmp(student s1,student s2){
    int idcmp=strcmp(s1.id,s2.id),datecmp=strcmp(s1.date,s2.date);
    if(idcmp!=0){
        return idcmp>0 ? true : false;
    }else if(datecmp!=0){
        return datecmp>0 ? true : false;
    }else{
        return true;
    }
}

void healthWarning(){
	vector<student> students=readData(STUDENT_DATA);
    
    vector<student>::iterator first=students.begin();
    vector<student>::iterator end=students.end();
    
    sort(first,end,cmp);
    
    char id[50],ids[1000][50];
    int ids_n=-1;
    while(first!=end){//首先获取三天及以上不健康的同学的学号，将其放到数组中暂存
        int count=0,preDayHealth=1;
        strcpy(id,(*first).id);
        while(strcmp(id,(*first).id)==0){
            if(count>=3){
                //记录该学生学号
                strcpy(ids[++ids_n],(*first).id);
            }
            if(!preDayHealth && (*first).isHealthy ){
                count=0;
            }else if(!preDayHealth && !(*first).isHealthy){
                count++;
            }else if(preDayHealth && !(*first).isHealthy){
                count=1;
            }
            first++;
        }
    }

    for(int i=ids_n;i>-1;i--){//对于每一个不健康的同学，遍历数据库。将其所有信息放到vector数组中，打印出来。
        char goal_id[50];
        strcpy(goal_id,ids[i]);
        printf("%s",goal_id);

        first=students.begin();//重新获取指向数组头部的迭代器
        vector<student> goal_s;
        while(first!=end){
            if(strcmp(goal_id,(*first).id)==0){
                goal_s.push_back(*first);
            }    
            first++;
        }
        writeData(WARNING_STU,goal_s,4);
    }
    printf("数据生成成功！");
}
```



### 二、测试数据

```
201601001
常爽吉
36.1
1
09:30
20200429
y
201601001
常爽吉
36.7
0
10:30
20200430
y
201601001
常爽吉
35.8
0
11:30
20200501
y
201601001
常爽吉
36.9
0
12:30
20200502
y
201601001
常爽吉
37.1
0
13:30
20200503
y
201601001
常爽吉
37.2
0
14:30
20200504
y
201601001
常爽吉
39.5
0
15:30
20200505
y
201601001
常爽吉
40.1
0
16:30
20200506
y
201601001
常爽吉
36.1
0
17:30
20200507
y
201601001
常爽吉
36.1
0
18:30
20200508
y
201601001
常爽吉
36.3
1
19:30
20200509
y
201601001
常爽吉
37.2
0
20:30
20200510
y
201601001
常爽吉
36.1
0
21:30
20200511
y
201601001
常爽吉
37.2
0
22:30
20200512
y
201602001
成芳
36.9
0
23:30
20200429
y
201602001
成芳
37.2
0
00:30
20200430
y
201602001
成芳
37.6
0
01:30
20200501
y
201602001
成芳
36.4
0
02:30
20200502
y
201602001
成芳
40.5
0
03:30
20200503
y
201602001
成芳
37.0
0
04:30
20200504
y
201602001
成芳
37.6
0
05:30
20200505
y
201602001
成芳
36.9
0
06:30
20200506
y
201602001
成芳
36.5
0
07:30
20200507
y
201602001
成芳
37.1
0
08:30
20200508
y
201602001
成芳
37.5
0
09:30
20200509
y
201602001
成芳
37.3
0
10:30
20200510
y
201602001
成芳
37.2
1
11:30
20200511
y
201602001
成芳
38.0
0
12:30
20200512
y
201603001
杜函
37.0
0
13:30
20200429
y
201603001
杜函
40.1
0
14:30
20200430
y
201603001
杜函
37.6
0
15:30
20200501
y
201603001
杜函
40.5
0
16:30
20200502
y
201603001
杜函
36.8
0
17:30
20200503
y
201603001
杜函
36.9
0
18:30
20200504
y
201603001
杜函
35.8
0
19:30
20200505
y
201603001
杜函
35.7
0
20:30
20200506
y
201603001
杜函
36.4
0
21:30
20200507
y
201603001
杜函
36.5
0
22:30
20200508
y
201603001
杜函
36.5
1
23:30
20200509
y
201603001
杜函
36.2
0
00:30
20200510
y
201603001
杜函
37.4
0
01:30
20200511
y
201603001
杜函
37.2
0
02:30
20200512
y
201604001
戚琳秋
40.4
0
03:30
20200429
y
201604001
戚琳秋
36.0
0
04:30
20200430
y
201604001
戚琳秋
36.4
0
05:30
20200501
y
201604001
戚琳秋
38.0
0
06:30
20200502
y
201604001
戚琳秋
36.5
0
07:30
20200503
y
201604001
戚琳秋
37.6
0
08:30
20200504
y
201604001
戚琳秋
36.9
0
09:30
20200505
y
201604001
戚琳秋
35.7
0
10:30
20200506
y
201604001
戚琳秋
36.9
0
11:30
20200507
y
201604001
戚琳秋
37.1
0
12:30
20200508
y
201604001
戚琳秋
36.0
0
13:30
20200509
y
201604001
戚琳秋
40.9
0
14:30
20200510
y
201604001
戚琳秋
36.6
0
15:30
20200511
y
201604001
戚琳秋
37.2
0
16:30
20200512
y
201605001
昌竹秋
35.8
0
17:30
20200429
y
201606001
姜宜
37.0
0
18:30
20200430
y
201607001
顾瑛炎
36.4
0
19:30
20200501
y
201608001
熊玲鹏
36.5
0
20:30
20200502
y
201609001
宋菲晨
36.8
0
21:30
20200503
y
201610001
谈真莹
36.1
0
22:30
20200504
y
201611001
水泽希
37.5
0
23:30
20200505
y
201612001
彭盛
37.2
0
00:30
20200506
y
201707091
苗婵悦
37.4
1
01:30
20200507
y
201807091
沈芳
36.5
0
02:30
20200508
y
201907091
曹丹婉
36.5
0
03:30
20200509
y
201708091
尹旭环
40.4
1
04:30
20200510
y
201808091
魏聪纯
36.3
0
05:30
20200511
y
201908091
盛倩
38.4
0
06:30
20200512
y
201901123
汤玲怡
38.2
0
07:30
20200430
y
201901124
姚蓉莉
36.3
0
08:30
20200501
y
201901125
伏伦
36.3
0
09:30
20200502
y
201901126
廉丽
36.5
0
10:30
20200503
y
201901127
樊蕊冰
36.3
0
11:30
20200504
y
201901128
宋玉萍
35.8
1
12:30
20200505
y
201901129
席舒
40.8
1
13:30
20200430
y
201901130
罗妍荔
36.1
0
14:30
20200501
y
201901131
明凝
39.2
0
15:30
20200502
y
201901132
郝芝淇
39.9
1
16:30
20200503
y
201901133
彭芸吉
37.7
0
17:30
20200504
y
201901134
秦希玲
36.6
0
18:30
20200505
y
201901135
袁薇萍
35.8
0
19:30
20200504
y
201901136
钱婉薇
38.1
0
20:30
20200505
y
201901137
盛梦韵
35.8
0
21:30
20200430
y
201901138
邹妤致
40.6
1
22:30
20200501
y
201901139
祁伯
37.6
0
23:30
20200502
y
201901140
伏芝
35.9
0
00:30
20200506
y
201901141
项娟
40.4
0
01:30
20200506
y
201901142
云美致
40.2
0
02:30
20200506
y
201901143
余蕊英
37.5
0
03:30
20200506
y
201901144
管鸣
36.4
0
04:30
20200506
y
201901145
董希蓓
36.9
0
05:30
20200506
y
201901146
伍瑾蓓
36.1
0
06:30
20200506
y
201901147
罗环雪
39.2
0
07:30
20200506
y
201901148
霍荔璐
36.7
0
08:30
20200506
y
201901149
虞茜腾
36.7
0
09:30
20200506
y
201901150
席一瑶
36.2
0
10:30
20200506
y
201901151
贾纨
37.0
1
11:30
20200506
y
201901152
孔思美
36.9
0
12:30
20200506
y
201901153
严蕊之
39.4
1
13:30
20200506
y
201901154
秦影婵
38.1
1
14:30
20200506
y
201901155
曹宜琳
37.9
0
15:30
20200506
y
201901156
苏佳琴
35.8
0
16:30
20200506
y
201901157
邬镇晗
40.0
0
17:30
20200506
y
201901158
傅荷依
36.6
0
18:30
20200506
y
201901159
吴琴玉
37.0
0
19:30
20200506
y
201901160
夏菁
39.0
0
20:30
20200506
y
201901161
安青娅
37.3
0
21:30
20200506
y
201901162
时聪
36.8
0
22:30
20200506
y
201901163
汪婵以
37.3
0
23:30
20200506
y
201901164
梁皑芸
37.5
0
00:30
20200506
y
201901165
管娟嫣
36.9
1
01:30
20200506
y
201901166
余克
37.2
0
02:30
20200506
y
201901167
范瑶雪
37.0
0
03:30
20200506
y
201901168
钱美
36.7
0
04:30
20200506
y
201901169
昌瑶云
38.2
0
05:30
20200506
y
201901170
苏颖茗
39.3
0
06:30
20200506
y
201901171
喻荷
36.8
0
07:30
20200506
y
201901172
闵瑞冠
36.8
1
08:30
20200506
y
201901173
孙萱玉
38.6
0
09:30
20200506
y
201901174
童凤茜
35.9
0
10:30
20200506
y
201901175
尤宜婉
37.7
0
11:30
20200506
y
201901176
秦树淇
37.3
0
12:30
20200506
y
201901177
萧先园
36.6
0
13:30
20200506
y
201901178
沈莎枝
36.2
0
14:30
20200506
y
201901179
费珍融
39.9
0
15:30
20200506
y
201901180
周翔
40.2
0
16:30
20200506
y
201901181
湛凡环
37.7
0
17:30
20200506
y
201901182
戴乐
36.3
0
18:30
20200506
y
201901183
戚时滢
37.6
0
19:30
20200506
y
201901184
平羽瑶
36.4
0
20:30
20200506
y
201901185
毕嘉玉
37.6
0
21:30
20200506
y
201901186
危蓉
36.1
0
22:30
20200506
y
201901187
夏元雪
36.0
0
23:30
20200506
y
201901188
邱泽
37.4
0
00:30
20200506
y
201901189
苗巧先
37.1
0
01:30
20200506
y
201901190
尤策建
35.7
1
02:30
20200506
y
201901191
支嘉
37.2
0
03:30
20200506
y
201901192
元源函
35.8
0
04:30
20200506
y
201901193
元树
39.6
0
05:30
20200506
y
201901194
莫奕云
36.3
1
06:30
20200506
y
201901195
汪旭慧
36.7
0
07:30
20200506
y
201901196
闵茜
36.9
0
08:30
20200506
y
201901197
沈依
36.0
0
09:30
20200506
y
201901198
吕羽娜
36.4
0
10:30
20200506
y
201901199
云冠岚
36.3
0
11:30
20200506
y
201901200
孟淳
37.4
0
12:30
20200506
y
201901201
倪凡
35.9
0
13:30
20200506
y
201901202
李渊
36.0
0
14:30
20200506
y
201901203
伍琬芝
35.7
0
15:30
20200506
y
201901204
柏佳莎
36.6
0
16:30
20200506
y
201901205
方弘筠
36.2
0
17:30
20200506
y
201901206
萧航
39.8
0
18:30
20200506
y
201901207
娄雪
37.4
0
19:30
20200506
y
201901208
熊莹娅
36.8
0
20:30
20200506
y
201901209
虞乐
38.9
0
21:30
20200506
y
201901210
盛嘉翰
37.4
0
22:30
20200506
y
201901211
元澜希
37.7
1
23:30
20200506
y
201901212
倪婷贞
37.4
0
00:30
20200506
y
201901213
苏之蓉
37.0
0
01:30
20200506
y
201901214
郝莹莉
37.3
0
02:30
20200506
y
201901215
康梦
38.4
0
03:30
20200506
y
201901216
任颖
37.3
0
04:30
20200506
y
201901217
邱琦丽
36.4
0
05:30
20200506
y
201901218
伍影玲
41.0
0
06:30
20200506
y
201901219
杨和
40.1
0
07:30
20200506
y
201901220
狄希晗
36.2
0
08:30
20200506
y
201901221
狄谦
38.5
0
09:30
20200506
y
201901222
蒋菁怡
36.8
0
10:30
20200506
y
201901223
梅育纯
37.6
0
11:30
20200506
y
201901224
秦夕薇
37.3
0
12:30
20200506
y
201901225
孟泽薇
37.7
0
13:30
20200506
y
201901226
秦枫
36.7
0
14:30
20200506
y
201901227
汪雪先
36.4
0
15:30
20200506
y
201901228
方雨彤
36.7
0
16:30
20200506
y
201901229
岑航楠
38.0
0
17:30
20200506
y
201901230
禹蓉辰
38.4
0
18:30
20200506
y
201901231
杜以
38.4
0
19:30
20200506
y
201901232
柏怡妤
36.0
1
20:30
20200506
y
201901233
金娟茜
36.5
0
21:30
20200506
y
201901234
水宏
37.3
1
22:30
20200506
y
201901235
王泽瑶
37.5
0
23:30
20200506
y
201901236
时茹艳
36.4
0
00:30
20200506
y
201901237
姜瑛茜
35.8
0
01:30
20200506
y
201901238
黄晴
37.5
0
02:30
20200506
y
201901239
谢文策
36.3
0
03:30
20200506
y
201901240
华宜沫
37.6
0
04:30
20200506
y
201901241
骆致欢
36.0
1
05:30
20200506
y
201901242
锺荔
36.9
0
06:30
20200506
y
201901243
赵珊
36.2
0
07:30
20200506
y
201901244
闵寒纨
37.4
0
08:30
20200506
y
201901245
孟锦
36.0
0
09:30
20200506
y
201901246
麻芝岚
36.0
0
10:30
20200506
y
201901247
袁浩
37.1
0
11:30
20200506
y
201901248
祁怡
39.0
0
12:30
20200506
y
201901249
徐竹蕊
37.6
0
13:30
20200506
y
201901250
平舒姬
37.0
0
14:30
20200506
y
201901251
魏淇爱
36.4
0
15:30
20200506
y
201901252
费颖言
37.2
0
16:30
20200506
y
201901253
毛琳
37.3
0
17:30
20200506
y
201901254
周风
36.9
0
18:30
20200506
y
201901255
谢秀
36.4
0
19:30
20200506
y
201901256
廉茹荷
37.2
0
20:30
20200506
y
201901257
李琴瑛
36.9
0
21:30
20200506
y
201901258
伏珊
38.1
0
22:30
20200506
y
201901259
万钊韵
37.1
0
23:30
20200506
y
201901260
范影
36.0
1
00:30
20200506
y
201901261
云瑞媛
36.2
0
01:30
20200506
y
201901262
唐晴伯
40.6
1
02:30
20200506
y
201901263
琪
37.0
0
03:30
20200506
y
201901264
水苑斌
36.4
0
04:30
20200506
y
201901265
董允佳
37.6
0
05:30
20200506
y
201901266
尹亮昭
37.5
0
06:30
20200506
y
201901267
伍玉珠
41.0
0
07:30
20200506
y
201901268
麻吉
36.0
0
08:30
20200506
y
201901269
谈纨亚
36.5
0
09:30
20200506
y
201901270
管滢
40.9
1
10:30
20200506
y
201901271
于娜
37.2
0
11:30
20200506
y
201901272
杨雁璐
36.0
0
12:30
20200506
y
201901273
施叶舒
35.7
0
13:30
20200506
y
201901274
邵晗宏
35.8
0
14:30
20200506
y
201901275
齐娜芸
36.6
0
15:30
20200506
y
201901276
邹聪
36.0
0
16:30
20200506
y
201901277
张冠
36.2
0
17:30
20200506
y
201901278
姜影漩
36.9
0
18:30
20200506
y
201901279
路筠萱
35.9
0
19:30
20200506
y
201901280
昌丹淳
37.4
1
20:30
20200506
y
201901281
毛家寒
36.5
0
21:30
20200506
y
201901282
明渊卿
36.2
0
22:30
20200506
y
201901283
姜莲云
37.2
0
23:30
20200506
y
201901284
柏钧函
36.7
0
00:30
20200506
y
201901285
林姬瑶
39.4
0
01:30
20200506
y
201901286
宋素
39.1
0
02:30
20200506
y
201901287
章卿秀
37.1
1
03:30
20200506
y
201901288
水荣
36.8
0
04:30
20200506
y
201901289
颜婷琴
37.1
0
05:30
20200506
y
201901290
蓝若伊
38.5
0
06:30
20200506
y
201901291
谢美宁
37.3
0
07:30
20200506
y
201901292
闵爱
36.4
0
08:30
20200506
y
201901293
邹克育
40.5
1
09:30
20200506
y
201901294
董浩茜
37.2
0
10:30
20200506
y
201901295
锺青栋
36.3
0
11:30
20200506
y
201901296
卜巧浩
36.9
0
12:30
20200506
y
201901297
雷腾
36.4
0
13:30
20200506
y
201901298
葛晓妤
36.7
0
14:30
20200506
y
201901299
茅黛莎
36.2
0
15:30
20200506
y
201901300
童淳
37.4
0
16:30
20200506
y
201901301
卫蓓
36.6
0
17:30
20200506
y
201901302
臧璧
36.0
0
18:30
20200506
y
201901303
锺函乐
37.4
0
19:30
20200506
y
201901304
马淇娜
36.8
0
20:30
20200506
y
201901305
酆谦姣
37.2
0
21:30
20200506
y
201901306
伏荷
37.5
0
22:30
20200506
y
201901307
汪勤茗
35.8
0
23:30
20200506
y
201901308
罗咏
36.2
0
00:30
20200506
y
201901309
祝允
36.0
0
01:30
20200506
y
201901310
蔡洁冰
37.7
0
02:30
20200506
y
201901311
宋琳家
36.1
0
03:30
20200506
y
201901312
卫融
35.8
0
04:30
20200506
y
201901313
计玲
37.1
0
05:30
20200506
y
201901314
阮真蓓
36.4
0
06:30
20200506
y
201901315
苗菲冰
35.8
0
07:30
20200506
y
201901316
柏梁宜
37.0
0
08:30
20200506
y
201901317
田素琬
37.0
0
09:30
20200506
y
201901318
李希镇
37.0
0
10:30
20200506
y
201901319
尤风
36.4
0
11:30
20200506
y
201901320
谢旭
36.4
0
12:30
20200506
y
201901321
华晴
35.8
0
13:30
20200506
y
201901322
狄怡娴
37.2
0
14:30
20200506
y
201901323
陈滢
37.5
0
15:30
20200506
y
201901324
邬媛旭
36.4
0
16:30
20200506
y
201901325
许聪行
36.0
0
17:30
20200506
y
201901326
何晗纯
36.4
0
18:30
20200506
y
201901327
董妹薇
37.1
1
19:30
20200506
y
201901328
郭雅
36.5
0
20:30
20200506
y
201901329
杜枫希
36.9
0
21:30
20200506
y
201901330
徐伊艺
36.3
0
22:30
20200506
y
201901331
苏艳
36.3
0
23:30
20200506
y
```

## 试题02: 2021 某校研究生招生成绩管理系统

###  一、设计思路

分为四个模块（Module）、一个主界面（home）、一个登录界面（login）,其中主界面、四个模块需要登录才能够看到与操作。

#### 1、定义与声明

建立结构体user和student用来存储各类用户信息和考生信息。

```c++
typedef struct user{
    int auth;//用户权限值，用来区分不同用户
    char id[50];
    char password[50];
}user;
typedef struct student{
    char id[50];//student exam number
	char name[50];
    char institute[50];
    char category[10];//报考类别，分为学硕、专硕以及非全日制 3 种
    int basicScore1;//基础课1成绩
    int basicScore2;//基础课2成绩
	int professionScore1;//专业课1成绩
    int professionScore2;//专业课2成绩
    int preScore;//初始成绩之和
    int secScore;//复试成绩
    int oralScore;//口语成绩
    double totalAchieve;//综合成绩
}student;
```

定义常量用来表示文件名称，在实际写代码是会更好理解数据应存放在哪个文件中。

```c++
#define USER_DATA "data1.txt"
#define STUDENT_DATA "data2.txt"
#define STU_MASTER "data3.txt"
#define PRO_MASTER "data4.txt"
#define PT_MASTER "data5.txt"
```

程序中所使用的函数主要有以下几类：

* 登录界面

```c++
user login();
```

* 主界面

```c++ 
void welcome();

void mainPage(user u);
```

* 用户管理界面

```c++
void addUserInfo();

void selectUserInfo();

void alterUserInfo();

void deleteUserInfo();
```

* 学生管理界面

```c++
bool isCorrect_stu_id(char *stu_id,int &institute);

void addStuInfo();

void selectStuInfo();

void alterStuInfo();

void deleteStuInfo();
```


* 文件读取相关

```c++
void parseData(vector<student> students,vector<student>& StuM,vector<student>& ProM,vector<student>& PTM);

vector<student> readStuData(const char *fileName);

vector<user> readUserData(const char *fileName);

void writeStuData(const char *fileName,vector<student> students,int writeType);

void writeUserData(const char *fileName,vector<user> users);
```

* 学生数据综合排序并导出到文件

```c++
bool cmpStudent(student s1,student s2);

void statistic();
```




#### 2、文件读写

在对数据进行增删改查之前，要进行一些文件读写操作。我将这些操作封装到了函数中，对于文件中的每一条数据，都放到了C++的vector容器（类似于数组）中，因此在系统中进行增删改查只需要对vector进行操作，而不涉及对文件的操作。文件的读写按照返回值不同，分为两类。对student和user的读写。

* `vector<student>`的读写操作

```c++
vector<student> readStuData(const char *fileName){
    student s;
    vector<student> students;
    FILE *fp=fopen(fileName,"r");
    while(fscanf(fp,"%s %s %s %s %d %d %d %d %d %d %d %lf",\
                 s.id,s.name,s.institute,s.category,&s.basicScore1,\
                 &s.basicScore2,&s.professionScore1,&s.professionScore2,\
                 &s.preScore,&s.secScore,&s.oralScore,&s.totalAchieve)>0){
        students.push_back(s);
    }
    fclose(fp);
    return students;
}

/*writeType==0 那么将元素按行写入
  writeType==1 那么元素每十行会添加一空行。*/
void writeStuData(const char *fileName,vector<student> students,int writeType){
    int count = 0, total = 0;
	FILE *fp=fopen(fileName,"w");
    for(int i=0;i<students.size();i++){
        if(count == 10 && writeType == 1){
            fprintf(fp,"\n");
        	count=0;
        }
        
        int signal = fprintf(fp,"%s %s %s %s %d %d %d %d %d %d %d %.2lf\n",\
                            students[i].id, students[i].name, students[i].institute,\
                             students[i].category, students[i].basicScore1,\
                             students[i].basicScore2, students[i].professionScore1,\
                             students[i].professionScore2, students[i].preScore,\
                             students[i].secScore, students[i].oralScore,\
                             students[i].totalAchieve);
        
        if(signal < 1){
            printf("学号为 %s 的信息写入文件 %s 失败。\n",students[i].id,fileName);
        }else{
            total++;
        }
    }
    fclose(fp);
    printf("%s 共写入了 %d 条数据\n",fileName,total);
}
```

* `vector<user>`的读写操作

```c++
vector<user> readUserData(const char *fileName){
    user u;
    vector<user> users;
    FILE *fp=fopen(fileName,"r");
    while(fscanf(fp,"%d %s %s",&u.auth,u.id,u.password)>0){
        users.push_back(u);
    }
    fclose(fp);
    return users;
}

void writeUserData(const char *fileName,vector<user> users){
    int total = 0;
	FILE *fp=fopen(fileName,"w");
    for(int i=0;i<users.size();i++){
        int signal = fprintf(fp,"%d %s %s\n",users[i].auth,users[i].id,users[i].password);
        if(signal < 1){
            printf("用户 %s 的信息写入文件 %s 失败。\n",users[i].id,fileName);
        }else{
            total++;
        }
    }
    fclose(fp);
    printf("%s 共写入了 %d 条数据\n",fileName,total);
}
```

####　3、登录界面

返回值为对应用户组所拥有的权限值。规定 1 为系统管理员 2 为系统操作员 3 为学生用户。具体操作：

1、提示用户输入用户名和密码。获取输入后打开data1.txt 文件，先找用户名，找到用户名后，对比密码是否正确，如果正确，进入第2步。

2、用户输入的用户名与密码正确。检验用户名和密码是否相同，如果相同提示用户修改密码。

3、用户输入的用户名与密码不正确。要求用户重新输入或退出系统提示。

由于需要对文件进行修改，则需要读入文件全部信息到vector中，如有修改密码则覆盖写入文件。如果没有则最后关闭文件

```c++
user login(){
    //*******用户输入功能*****************
    char id[50],password[50];
    printf("请输入用户名：");
    cin>>id;
    printf("请输入密码：");
    cin>>password;
    
    //*******从文件中获取用户数据************
    vector<user> users=readUserData(USER_DATA);
    vector<user>::iterator first=users.begin();
    vector<user>::iterator end=users.end();
    while (strcmp((*first).id,id)!=0 && first!=end){
        first++;
    }
    
    //*******检验用户名与密码************
    if(first==end){
        printf("用户名不存在，程序即将退出！");
        Sleep(3000);
        exit(0);
    }
    int wrongCount=0;
    while(strcmp((*first).password,password)!=0){
        wrongCount++;
        if(wrongCount>3) exit(0);
        printf("密码错误，请重新输入密码：（已输入错误%d次,3次以上将退出系统）",wrongCount);
    	cin>>password;
    }
    if(strcmp((*first).password,id)==0){
        printf("首次登录系统，请修改密码\n");
        printf("请输入修改后的密码：");
        char pw[50];
        cin>>pw;

        user newUser;
        newUser.auth=(*first).auth;
        strcpy(newUser.id,(*first).id);
        strcpy(newUser.password,pw);

        //先将该用户从容器中删除，用和最后一个元素交换，删除最后一个元素的方法。然后再重新放入该元素。
        swap(*first,*(end-1));
        users.pop_back();
        users.push_back(newUser);
        writeUserData(USER_DATA,users);
        printf("密码修改成功！");
        Sleep(500);
    }
    return *first;
 }

```

####　4、主界面

```c++
void welcome(){
	printf("==============欢迎进入研究生招生成绩管理系统=============\n");
    printf("                  进入用户管理模块\n");
    printf("                    11、用户添加\n");
    printf("                    12、用户查询\n");
    printf("                    13、用户删除\n");
    printf("                    14、用户修改\n");
    printf("               进入学生基本信息管理模块\n");
    printf("                    21、学生添加\n");
    printf("                    22、学生查询\n");
    printf("                    23、学生删除\n");
    printf("                    24、学生修改\n");
    printf("                    3、进入学生数据统计模块\n");
    printf("                    4、退出系统\n");
    printf("======================================================\n");
    printf("请选择所要进行的操作：（填写数字即可）");
}
```

```c++
void mainPage(user u){
    char c='y';
    while(c=='y'){
        system("cls");
        welcome();
        int flag=0;
    	cin>>flag;
        if(flag==11 && u.auth==1){
            addUserInfo();
        }else if(flag==12 && u.auth==1){
            selectUserInfo();
        }else if(flag==13 && u.auth==1){
            deleteUserInfo();
        }else if(flag==14 && u.auth==1){
            alterUserInfo();
        }else if(flag==21 && u.auth==2){
            addStuInfo();
        }else if(flag==22 && (u.auth==2 || u.auth==3)){
            selectStuInfo();
        }else if(flag==23 && u.auth==2){
            deleteStuInfo();
        }else if(flag==24 && u.auth==2){
            alterStuInfo();
        }else if(flag==3){
            statistic();
        }else if(flag==4){
            exit(0);
        }else{
            printf("输入错误,或者没有权限，请重新输入！\n");
        }
        printf("是否继续使用该系统（y/n）\n");
        cin>>c;
    }
}
```



 #### 5、用户管理模块

**权限说明**

​	`u.auth==1`，系统管理员，能对data1.txt中数据有增删改查权限。

​	`u.auth==2`，系统操作员，能对data2.txt中数据有增、查权限。

​	`u.auth==3`，学生用户，能对data2.txt中数据有查权限。

**功能说明**

增加功能打开文件对数据进行追加操作，完成后关闭文件。查删改这三个操作都需要读取现有的数据文件，并将文件中存放的数据写入内存（结构体）中，使用`readData`来进行读取，删和该的前提是先查到对应的数据，之后按功能不同分别设计。

1. 用户信息查询 `selectUserInfo`

```c++
//输入用户名，可查询用户密码、权限等信息。
void selectUserInfo(int searchType){
    int n,flag=0;
	user *total_u=readData("data1.txt",n);
    user u={0};
    
    char c='y';
    while(c=='y'){
        printf("请选择要查询的用户账号：");
        scanf("%d",&u.id);
        getchar();

        for(int i=0;i<n;i++){
            if(strcmp(u.id,total_u[i])==0){
                u=total_u[i];
                flag=1;
            }
        }
        if(flag==1 && searchType==1){
            printf("用户权限 用户名 用户密码\n");
            printf("%d %s %s",u.auth,u.id,u.password);
        }else if(flag==1 && searchType==3){
            
        }else if(flag==1 && searchType==4){
            
        }else{
            printf("未找到对应用户！");
        }
        
        printf("是否继续查询？(y/n)  ");
        scanf("%c",&c);
        getchar();
    }
}
```

2. 用户信息增加`addUserInfo`

```c++
void addUserInfo(){
    vector<user> users=readUserData(USER_DATA);
	
	char c='y';
	while(c=='y'){
        user u={0};
        printf("添加用户中\n");
        printf("请输入用户账号：");
        scanf("%s",u.id);
        getchar();

        printf("请输入用户密码：");
        scanf("%s",u.password);
        getchar();

        printf("请输入用户权限（1 为系统管理员 2 为系统操作员 3 为学生用户）：");
        scanf("%d",&u.auth);
        getchar();

        users.push_back(u);
        
        printf("是否继续录入？(y/n)\n");
        scanf("%c",&c);
        getchar();
	}
	writeUserData(USER_DATA,users);
}
```

3. 用户信息修改`alterUserInfo`

```c++
void alterUserInfo(user &u){ 
	
}
```




4. 用户信息删除`deleteUserInfo`

```c++
void deleteUserInfo(user &u){
	
}
```

#### 6、学生管理模块

5. 学生信息查看`selectStuInfo`

输入准考证号，可以查询学生信息。利用模块4中`readData()`函数返回的student数组，从数组中查找对应学生信息，并将其打印到屏幕上。

```c++
void selectStuInfo(){
    //************获取所有学生信息**************
    vector<student> students =readStuData(STUDENT_DATA);
    
    //********根据准考证号在所有学生信息中查询****
    char c='y';
    while(c=='y'){
        printf("请输入准考证号：");
        char id[50];
        scanf("%s",id);
        getchar();

        vector<student>::iterator first=students.begin();
        vector<student>::iterator end=students.end();
        while (strcmp((*first).id,id)!=0){
            first++;
        }

        student s=(*first);
        printf("学号 姓名 学院 报考类别 基础课成绩1 基础课成绩2 专业课成绩1 专业课成绩2 初始总成绩 "\
               "复试成绩 口语成绩 综合成绩\n");
        printf("%s %s %s %s %d %d %d %d %d %d %d %.2lf\n",\
                            s.id, s.name, s.institute,\
                             s.category, s.basicScore1,\
                             s.basicScore2, s.professionScore1,\
                             s.professionScore2, s.preScore,\
                             s.secScore, s.oralScore,\
                             s.totalAchieve);
        
        printf("是否继续查询（y/n）");
        scanf("%c",&c);
        getchar();
    }
}
```



6. 学生信息增加`addStuInfo`

引申函数-复试考号识别，传入学生考号，判断是否合法，然后填充报考学院。判断方法如下：

1. 首先判断字符串长度是否为9，不是则返回false。
2. 其次判断每个字符是否是数字，如果有非数字则返回false。
3. 分割字符串前4位，中间2位，后3位。转为数字判断大小。然后返回中间两位（学院代码）。

```c++
int isCorrect_stu_id(char *stu_id){
	if(strlen(stu_id)!=9) return 0;
    
	for(int j=0;j<9;j++){
		if(!isdigit(stu_id[j])) return 0;
    }
    
	char y[5],i[3],n[4];
	strncpy(y,stu_id,4);
	strncpy(i,stu_id+4,2);
    strncpy(n,stu_id+6,3);
    
	/*atoi会接收尽可能多的字符以组成合法的整数表示，并转换之为整数值。
	注意到一点，如果接受的参数有整数也有其他字符，那么只会转换整数部分，忽略非字符部分。
	如果没有数字字符，则返回0*/
	int year=atoi(y),institute=atoi(i),number=atoi(n);
	if(year!= 2021 || institute>12 || institute<1 || number==0){
		return 0;
	}
	
	return institute;
}

void addStuInfo(){
	char insti[][50]={"","通信学院","计算机学院","光电学院","自动化学院","经管学院",\
    "研究生院","外语学院","安法学院","体育学院","传媒学院","先进制造学院","马克思主义学院"};
    vector<student> students=readStuData(STUDENT_DATA);

	char c='y';
	while(c=='y'){
        student s={0};
		int institute;
        printf("添加学生信息中\n");
        
        printf("请输入复试考号：");
        do{
            scanf("%s",s.id);
            getchar();
            
            if(isCorrect_stu_id(s.id,institute)){
            	break;
            }else{
            	printf("复试考号输入错误，请重试！\n");
            }
		}while(1);
		
		strcpy(s.institute,insti[institute]);
		
        printf("请输入姓名：");
        scanf("%s",s.name);
        getchar();

        printf("请输入报考类别（报考类别包含学硕、专硕以及非全日制 3 种）：");
        do{
        	scanf("%s",s.category);
        	if( (strcmp(s.category,"学硕")==0) || (strcmp(s.category,"专硕")==0) || (strcmp(s.category,"非全日制")==0) ){
        		break;
        	}else{
        		printf("报考类别输入错误！请重新输入");
        	}
        }while(1);
        
        printf("请输入基础课1的成绩：");
        do{
            scanf("%d",&s.basicScore1);
            getchar();
            if(s.basicScore1>100 || s.basicScore1<0){
            	printf("成绩不合法！\n");
            }else{
				break;
			}
        }while(1);
        
        printf("请输入基础课2的成绩：");
        do{
        	scanf("%d",&s.basicScore2);
        	getchar();
        	if(s.basicScore2>100 || s.basicScore2<0){
            	printf("成绩不合法！\n");
            }else{
				break;
			}
        }while(1);
        
        printf("请输入专业课1的成绩：");
        do{
        	scanf("%d",&s.professionScore1);
        	getchar();
        	if(s.professionScore1>150 || s.professionScore1<0){
            	printf("成绩不合法！\n");
            }else{
				break;
			}
        }while(1);
        
        printf("请输入专业课2的成绩：");
        do{
            scanf("%d",&s.professionScore2);
            getchar();
            if(s.professionScore2>150 || s.professionScore2<0){
                    printf("成绩不合法！\n");
            }else{
                    break;
            }
        }while(1);
        
        s.preScore=s.basicScore1+s.basicScore2+s.professionScore1+s.professionScore2;
        
        printf("请输入复试成绩：");
        scanf("%d",&s.secScore);
        getchar();
        
        printf("请输入口语成绩：");
        scanf("%d",&s.oralScore);
        getchar();
        
        s.totalAchieve=(double)s.preScore*0.6+(double)s.secScore*0.3+(double)s.oralScore*0.1;
        
        students.push_back(s);

        printf("信息录入成功！是否继续录入？(y/n)\n");
        scanf("%c",&c);
        getchar();
	}
	writeStuData(STUDENT_DATA,students,0);
}
```



7. 学生信息修改`alterStuInfo`

8. 学生信息删除`deleteStuInfo`

9. 返回上一级



#### 7、学生数据统计模块

对data2.txt中数据，先保存在内存结构体数组student中，另外建立三个结构体数组，`StuM[],ProM[],PTM[]`（学硕、专硕、非全），对结构体进行遍历，按照报考类别拆分到三个数组中，对每个数组按综合成绩初试总分、复试成绩、专业课 1 成绩、专业课 2 成绩的优先级顺序进行**综合排序**。排序结束后，分别将其存放在不同文件里。

分为四个函数来做这件事。

函数1负责打开文件，将文件中的所有内容读取到结构体数组中。传入文件名称，返回结构体数组和数组大小。

```c++
//针对用户信息的读取，使用c++的函数重载读取
vector<user> readData(char *fileName){
    user u;
    vector<user> users;
    FILE *fp=fopen(fileName,"r");
    while(fscanf(fp,"%d %s %s",&u.auth,u.id,u.password)>0){
        users.push_back(u);
    }
    fclose(fp);
    return users;
}
```

函数2负责将结构体数组按照报考类别拆分到三个数组中

```c++
void parseData(vector<student> students,vector<student>& StuM,vector<student>& ProM,vector<student>& PTM){
	for(int i=0;i<students.size();i++){
        if(strcmp(students[i].category,"学硕")==0){
            StuM.push_back(students[i]);
        }else if(strcmp(students[i].category,"专硕")==0){
            ProM.push_back(students[i]);
        }else if(strcmp(students[i].category,"非全日制")==0){
            PTM.push_back(students[i]);
        }else{
            printf("出错，报名类别为空");
        }
    }
}
```

函数3负责对结构体数组进行综合排序。主要使用c++ STL的快速排序算法`sort()`

```c++
bool cmpStudent(student s1,student s2){
    /*如果返回值小于0，那么a会排到b的前面
      如果返回值大于0，那么a会排到b的后面
      如果返回值等于0，那么a与b的位置不确定。
      假设 a b 都为整数，若 a>b 则a-b>0。直接返回值a会排在b的后面。
      若 a<b 则 a-b<0。直接返回值的话a会排在b的前面。
      那么如果要降序排列，需要返回 b-a 的值。
      当综合成绩不相等时，返回他两个的差值，会优先按综合成绩排列。如果相等则依次判断初试总分、复试成绩等
    */
    int result=0;
    if(s1.totalAchieve != s2.totalAchieve){
        result=s2.totalAchieve - s1.totalAchieve;
    }else if(s1.preScore != s2.preScore){
        result=s2.preScore - s1.preScore;
    }else if(s1.secScore != s2.secScore){
        result=s2.secScore - s1.secScore;
    }else if(s1.professionScore1 != s2.professionScore1){
        result=s2.professionScore1 - s1.professionScore1;
    }else if(s1.professionScore2 != s2.professionScore2){
        result=s2.professionScore2 - s1.professionScore2;
    }else{
        // nothing to do
    }
    return result<0 ? true : false;
}
```

函数4负责将数组中的数据输出到文件中去



同时主函数负责将这四个函数结合到一块，共同实现模块4学生数据统计的功能

```c++
void statistic(){
	printf("正在进行数据统计，请稍候\n");
    vector<student> students = readData(STUDENT_DATA);
    
    vector<student> StuM,ProM,PTM;
    parseData(students,StuM,ProM,PTM);
    
    sort(StuM.begin(),StuM.end(),cmpStudent);
    sort(ProM.begin(),ProM.end(),cmpStudent);
    sort(PTM.begin(),PTM.end(),cmpStudent);
    
    writeData(STU_MASTER,StuM);
    writeData(PRO_MASTER,ProM);
    writeData(PT_MASTER,PTM);
}
```

### 二、测试用例

#### 1、用户数据

```
权限 账号 密码
1	admin	admin
2	user01	user01
2	user02	user02
2	user03	user03
2	user04	user04
2	user05	user05
2	user06	user06
3	202101001	202101001
3	202101002	202101002
3	202101003	202101003
3	202101004	202101004
3	202101005	202101005
3	202101006	202101006
3	202101007	202101007
3	202101008	202101008
3	202101009	202101009
3	202101010	202101010
3	202102001	202102001
3	202102002	202102002
3	202102003	202102003
3	202102004	202102004
3	202102005	202102005
3	202103001	202103001
3	202104001	202104001
3	202105001	202105001
3	202106001	202106001
3	202107001	202107001
3	202108001	202108001
3	202109001	202109001
3	202110001	202110001
3	202111001	202111001
3	202112001	202112001

```

#### 2、学生数据

```
学号	姓名	报考类别	基础课1成绩	基础课2成绩	专业课1成绩	专业课2成绩	复试成绩	口语成绩
202101001	张三	学硕	86	90	102	102	77	56
202101002	李四	学硕	90	86	123	113	78	34
202101003	王五	学硕	72	56	122	104	67	87
202101004	小刘	专硕	77	34	89	98	86	65
202101005	霍天虎	专硕	78	87	34	106	51	85
202101006	张峰	专硕	67	65	87	107	64	95
202101007	李敖	非全日制	86	73	65	147	63	10
202101008	忙角	非全日制	83	74	121	123	66	64
202101009	斯琴高丽	非全日制	84	77	101	123	67	75
202101010	王帅	专硕	73	90	101	122	84	65
202102001	蔡徐坤	专硕	75	51	102	89	74	73
202102002	继光	专硕	75	64	113	100	64	74
202102003	苏方	专硕	72	63	104	141	88	77
202102004	亮亮	专硕	68	66	98	123	90	78
202102005	Akuan	学硕	66	67	106	76	34	67
202103001	Jack	学硕	64	64	107	68	66	86
202104001	March	学硕	85	84	123	66	64	34
202105001	山湖居	学硕	95	74	90	64	85	56
202106001	数据	学硕	100	64	100	85	85	34
202107001	悟空	学硕	64	88	141	95	95	87
202108001	看看	学硕	57	90	123	74	100	65
202109001	商家	学硕	58	34	76	64	64	78
202110001	大华监控	学硕	83	88	111	88	56	58
202111001	多放	非全日制	63	54	123	120	77	56
202112001	媳妇	非全日制	47	43	39	15	1	0

```

#### 3、快捷录入

说明：在用户添加页面复制以下数据可快速添加

* 学生数据

```
202101001
张三
学硕
86
90
102
102
77
56
y
202101002
李四
学硕
90
86
123
113
78
34
y
202101003
王五
学硕
72
56
122
104
67
87
y
202101004
小刘
专硕
77
34
89
98
86
65
y
202101005
霍天虎
专硕
78
87
34
106
51
85
y
202101006
张峰
专硕
67
65
87
107
64
95
y
202101007
李敖
非全日制
86
73
65
147
63
100
y
202101008
忙角
非全日制
83
74
121
123
66
64
y
202101009
斯琴高丽
非全日制
84
77
101
123
67
75
y
202101010
王帅
专硕
73
90
101
122
84
65
y
202102001
蔡徐坤
专硕
75
51
102
89
74
73
y
202102002
继光
专硕
75
64
113
100
64
74
y
202102003
苏方
专硕
72
63
104
141
88
77
y
202102004
亮亮
专硕
68
66
98
123
90
78
y
202102005
Akuan
学硕
66
67
106
76
34
67
y
202103001
Jack
学硕
64
64
107
68
66
86
y
202104001
March
学硕
85
84
123
66
64
34
y
202105001
山湖居
学硕
95
74
90
64
85
56
y
202106001
数据
学硕
100
64
100
85
85
34
y
202107001
悟空
学硕
64
88
141
95
95
87
y
202108001
看看
学硕
57
90
123
74
100
65
y
202109001
商家
学硕
58
34
76
64
64
78
y
202110001
大华监控
学硕
83
88
111
88
56
58
y
202111001
多放
非全日制
63
54
123
120
77
56
y
202112001
媳妇
非全日制
47
43
39
15
1
0
n

```

* 用户数据

```
user02
user02
2
y
user03
user03
2
y
user04
user04
2
y
user05
user05
2
y
user06
user06
2
y
202101001
202101001
3
y
202101002
202101002
3
y
202101003
202101003
3
y
202101004
202101004
3
y
202101005
202101005
3
y
202101006
202101006
3
y
202101007
202101007
3
y
202101008
202101008
3
y
202101009
202101009
3
y
202101010
202101010
3
y
202102001
202102001
3
y
202102002
202102002
3
y
202102003
202102003
3
y
202102004
202102004
3
y
202102005
202102005
3
y
202103001
202103001
3
y
202104001
202104001
3
y
202105001
202105001
3
y
202106001
202106001
3
y
202107001
202107001
3
y
202108001
202108001
3
y
202109001
202109001
3
y
202110001
202110001
3
y
202111001
202111001
3
y
202112001
202112001
3

```



## 试题04：

1. 系统用户表：用户名，密码

   ```c++
   typedef struct user{
       int auth;//用户权限值，用来区分不同用户
       char id[50];
       char password[50];
   }user;
   ```

2. 国家基本信息表：国家、所属洲、人口总数、国土面积、建成区面积、人口密度\新增确诊、累计确诊、累计死亡、累计治愈、当前死亡率、当前治愈率、严重指数。

   ```c++
   typedef struct countryInfo{
       char name[50];
       char contient[50];
       int population;
       double landArea;
       double builtArea;
       double density;
       int newDiagnosis;
       int cumDiagnosis;
       int cumDeath;
       int cumCure;
       double curDeathRate;
       double curCureRate;
       double severity;
       char date[50];
   }countryInfo;
   ```

   * **疫情严重指数** 是基于现存确诊（由累计确诊、累计死亡、累计治愈计算得来）、国家人口数、国家建成区面积综合计算而来，考虑到确诊人口密度以及确诊人口占比两方面因素，辅以确诊数在全球确诊占比来增加占比权重，综合反映各国疫情严重程度。
   * 建成区面积采用经合组织公布的各国建成区面积（有建筑区域的面积）。
   * 严重指数=（权重1 * 现存确诊人口密度+权重2 * 现存确诊率）* SQRT（现存确诊 * 1000000/全球现存确诊）* 10000；
   * 现存确诊人口密度=现存确诊数（个）/国家建成面积（平方公里）；
   * 现存确诊人口占比=现存确诊数（个）/人口数（个），
   * 现存确诊数=累计确诊-累计死亡-累计治愈；
   * 权重1+权重2=1；
   * 权重2/权重1=全球城建区人口密度；
   * 全球城建区人口密度=全球人口数/全球城建区面积。

3. 模块

   1. 登录模块
   2. 文件读写模块
   3. 录入每日每个国家疫情信息
   4. 计算疫情严重指数（由于计算严重指数需要提供当前全球现存确诊，等当日全部录入完成后，再进行计算）
   5. 按日期查看疫情信息
   6. 按国家查看疫情信息
   7. 退出系统

4. 登录模块代码

```

```



